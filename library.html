<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=0.8, maximum-scale=1.0, user-scalable=no">
    <title>THE SONGA - Library</title>
    <!-- Preconnect to critical domains -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://i.postimg.cc">
    <link rel="preconnect" href="https://accounts.google.com">
    
    <!-- Preload critical resources -->
    <link rel="preload" as="style" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <link rel="icon" type="image/x-icon" href="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Inline critical CSS -->
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }

        :root {
            --gold: #D4AF37;
            --gold-light: #F5E6B3;
            --gold-dark: #B8860B;
            --black: #000000;
            --white: #ffffff;
            --gray: #f5f5f5;
            --dark-gray: #333333;
            --light-gray: #e0e0e0;
            --accent: #25D366;
            --available: #2ecc71;
            --borrowed: #e74c3c;
            --reserved: #f39c12;
            --digital: #3498db;
            --fiction: #9b59b6;
            --non-fiction: #e67e22;
            --business: #1abc9c;
            --shadow: rgba(0, 0, 0, 0.1);
            --modal-overlay: rgba(0, 0, 0, 0.85);
            --card-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            --hover-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
            --background: #fafafa;
        }

        html {
            scroll-behavior: smooth;
        }

        body {
            background-color: var(--background);
            color: var(--black);
            line-height: 1.6;
            padding-bottom: 80px;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
        }

        body.modal-open {
            overflow: hidden;
        }

        /* BACK TO TOP BUTTON */
        .back-to-top {
            position: fixed;
            bottom: 100px;
            right: 20px;
            width: 50px;
            height: 50px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 4px 15px rgba(212, 175, 55, 0.3);
            transition: all 0.3s ease;
            opacity: 0;
            transform: translateY(20px);
            visibility: hidden;
            border: none;
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
            visibility: visible;
        }

        .back-to-top:hover {
            transform: translateY(-3px) scale(1.1);
            box-shadow: 0 8px 25px rgba(212, 175, 55, 0.4);
        }

        /* BOOK DETAILS MODAL */
        .book-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
            z-index: 3000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .book-modal.active {
            display: flex;
        }

        .book-modal-content {
            background-color: white;
            border-radius: 20px;
            width: 100%;
            max-width: 900px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease-out;
            position: relative;
        }

        @keyframes modalAppear {
            from { 
                transform: translateY(-20px) scale(0.95); 
                opacity: 0; 
            }
            to { 
                transform: translateY(0) scale(1); 
                opacity: 1; 
            }
        }

        .book-modal-header {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            padding: 1.8rem 2rem;
            position: relative;
            border-radius: 20px 20px 0 0;
        }

        .book-modal-header h2 {
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
            line-height: 1.3;
        }

        .book-modal-header p {
            font-size: 0.9rem;
            opacity: 0.9;
        }

        .close-book-modal {
            position: absolute;
            top: 20px;
            right: 20px;
            background: rgba(0, 0, 0, 0.15);
            border: none;
            color: var(--black);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.4rem;
            transition: all 0.3s ease;
            z-index: 10;
        }

        .close-book-modal:hover {
            background: rgba(0, 0, 0, 0.25);
            transform: rotate(90deg);
        }

        .book-modal-body {
            padding: 2rem;
            display: grid;
            grid-template-columns: 300px 1fr;
            gap: 2rem;
        }

        @media (max-width: 768px) {
            .book-modal-body {
                grid-template-columns: 1fr;
            }
        }

        .book-cover-large {
            width: 100%;
            height: 400px;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 8px 25px rgba(0, 0, 0, 0.15);
        }

        .book-cover-large img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .book-info {
            display: flex;
            flex-direction: column;
            gap: 1.5rem;
        }

        .book-meta {
            display: flex;
            flex-wrap: wrap;
            gap: 1rem;
            margin-bottom: 1rem;
        }

        .book-meta-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        .book-meta-item i {
            color: var(--gold-dark);
            width: 20px;
        }

        .book-description {
            color: var(--dark-gray);
            line-height: 1.7;
            margin-bottom: 1.5rem;
        }

        .book-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 8px;
            margin-bottom: 1.5rem;
        }

        .book-tag {
            background: var(--gold-light);
            color: var(--gold-dark);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            border: none;
        }

        .book-tag:hover {
            background: var(--gold);
            transform: translateY(-2px);
        }

        .book-availability {
            background: var(--gray);
            border-radius: 12px;
            padding: 1.5rem;
            margin-top: 1rem;
        }

        .availability-status {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .status-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .status-value {
            padding: 6px 12px;
            border-radius: 20px;
            font-weight: 700;
            font-size: 0.9rem;
        }

        .status-available {
            background: var(--available);
            color: white;
        }

        .status-borrowed {
            background: var(--borrowed);
            color: white;
        }

        .status-reserved {
            background: var(--reserved);
            color: white;
        }

        .availability-details {
            font-size: 0.9rem;
            color: var(--dark-gray);
            margin-bottom: 1rem;
        }

        .book-actions {
            display: flex;
            gap: 12px;
            margin-top: 1.5rem;
        }

        .book-action-btn {
            padding: 12px 24px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .borrow-btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            flex: 1;
        }

        .borrow-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }

        .borrow-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .digital-btn {
            background: linear-gradient(135deg, var(--digital), #2980b9);
            color: white;
        }

        .digital-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(52, 152, 219, 0.3);
        }

        .wishlist-btn {
            background: var(--gray);
            color: var(--dark-gray);
            border: 1px solid var(--light-gray);
        }

        .wishlist-btn:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        /* BOOK SOCIAL ACTIONS */
        .book-social-actions {
            display: flex;
            gap: 10px;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }

        .social-action-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            border: none;
            display: flex;
            align-items: center;
            gap: 8px;
            flex: 1;
            justify-content: center;
            background: var(--gray);
            color: var(--dark-gray);
            border: 1px solid var(--light-gray);
        }

        .social-action-btn:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .social-action-btn.liked {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border-color: rgba(231, 76, 60, 0.2);
        }

        .social-action-btn.saved {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold-dark);
            border-color: rgba(212, 175, 55, 0.2);
        }

        /* BOOK REVIEWS */
        .book-reviews {
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }

        .review-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1rem;
            box-shadow: var(--card-shadow);
            border-left: 4px solid var(--gold);
        }

        .review-header {
            display: flex;
            align-items: center;
            gap: 12px;
            margin-bottom: 1rem;
        }

        .review-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            overflow: hidden;
        }

        .review-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .review-meta {
            flex: 1;
        }

        .review-author {
            font-weight: 700;
            color: var(--black);
        }

        .review-date {
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        .review-stars {
            color: var(--gold);
        }

        .review-text {
            color: var(--dark-gray);
            line-height: 1.6;
        }

        /* BORROW MODAL */
        .borrow-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
            z-index: 3500;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .borrow-modal.active {
            display: flex;
        }

        .borrow-modal-content {
            background-color: white;
            border-radius: 16px;
            width: 100%;
            max-width: 500px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease-out;
            position: relative;
        }

        .borrow-modal-header {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            padding: 1.8rem 2rem;
            text-align: center;
            position: relative;
        }

        .borrow-modal-header h2 {
            font-size: 1.6rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        .borrow-modal-body {
            padding: 2rem;
        }

        .borrow-details {
            background: var(--gray);
            border-radius: 12px;
            padding: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .borrow-detail-item {
            display: flex;
            justify-content: space-between;
            margin-bottom: 0.8rem;
        }

        .borrow-detail-item:last-child {
            margin-bottom: 0;
        }

        .borrow-detail-label {
            font-weight: 600;
            color: var(--dark-gray);
        }

        .borrow-detail-value {
            color: var(--black);
            text-align: right;
        }

        .borrow-terms {
            font-size: 0.85rem;
            color: var(--dark-gray);
            line-height: 1.5;
            margin-top: 1.5rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }

        .borrow-modal-footer {
            display: flex;
            gap: 12px;
            margin-top: 2rem;
            padding-top: 1.5rem;
            border-top: 1px solid var(--light-gray);
        }

        .confirm-borrow-btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            border: none;
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            flex: 1;
        }

        .confirm-borrow-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }

        .cancel-borrow-btn {
            background: var(--gray);
            color: var(--dark-gray);
            border: 1px solid var(--light-gray);
            padding: 14px 28px;
            border-radius: 10px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 1rem;
            flex: 1;
        }

        .cancel-borrow-btn:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        /* SIGNIN MODAL */
        .signin-modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: var(--modal-overlay);
            z-index: 4000;
            justify-content: center;
            align-items: center;
            padding: 20px;
            backdrop-filter: blur(5px);
        }

        .signin-modal.active {
            display: flex;
        }

        .signin-content {
            background-color: white;
            border-radius: 16px;
            width: 100%;
            max-width: 420px;
            overflow: hidden;
            box-shadow: 0 25px 50px rgba(0, 0, 0, 0.3);
            animation: modalAppear 0.4s ease-out;
            position: relative;
        }

        .signin-header {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            padding: 2rem;
            text-align: center;
            position: relative;
        }

        .signin-header h2 {
            font-size: 1.8rem;
            margin-bottom: 0.5rem;
            font-weight: 700;
        }

        /* HEADER */
        header {
            background-color: var(--white);
            color: var(--black);
            padding: 0.5rem 1rem;
            position: sticky;
            top: 0;
            z-index: 100;
            box-shadow: 0 2px 15px rgba(0, 0, 0, 0.08);
            border-bottom: none;
            height: 64px;
            backdrop-filter: blur(10px);
        }

        .header-container {
            display: flex;
            justify-content: space-between;
            align-items: center;
            height: 100%;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
        }

        .logo img {
            height: 44px;
            width: auto;
            border-radius: 12px;
        }

        .brand-info {
            display: flex;
            flex-direction: column;
        }

        .brand-name {
            font-weight: 800;
            font-size: 1.3rem;
            color: var(--gold-dark);
            letter-spacing: -0.5px;
        }

        .brand-subtitle {
            font-size: 0.7rem;
            color: var(--dark-gray);
            font-style: italic;
            letter-spacing: 1px;
        }

        /* SEARCH BAR */
        .search-container {
            flex: 1;
            max-width: 400px;
            margin: 0 30px;
        }

        .search-box {
            display: flex;
            align-items: center;
            background: var(--background);
            border-radius: 24px;
            padding: 10px 20px;
            border: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .search-box:focus-within {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        .search-box i {
            color: var(--dark-gray);
            margin-right: 12px;
            font-size: 1rem;
        }

        .search-box input {
            border: none;
            background: transparent;
            outline: none;
            width: 100%;
            font-size: 0.95rem;
            color: var(--black);
        }

        .search-box input::placeholder {
            color: #999;
        }

        /* USER PROFILE - Enhanced */
        .auth-section {
            display: flex;
            align-items: center;
            gap: 15px;
            position: relative;
        }

        .notification-btn {
            position: relative;
            background: none;
            border: none;
            color: var(--dark-gray);
            cursor: pointer;
            font-size: 1.2rem;
            padding: 8px;
            border-radius: 50%;
            transition: all 0.3s ease;
            width: 44px;
            height: 44px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .notification-btn:hover {
            background: var(--gray);
            color: var(--gold-dark);
        }

        .notification-badge {
            position: absolute;
            top: 4px;
            right: 4px;
            width: 8px;
            height: 8px;
            background: #e74c3c;
            border-radius: 50%;
            border: 2px solid var(--white);
        }

        .notification-badge.hidden {
            display: none;
        }

        .notification-badge.count {
            width: 18px;
            height: 18px;
            font-size: 0.7rem;
            font-weight: bold;
            display: flex;
            align-items: center;
            justify-content: center;
            top: 0;
            right: 0;
        }

        /* NOTIFICATIONS DROPDOWN */
        .notifications-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px var(--shadow);
            width: 320px;
            max-height: 400px;
            overflow-y: auto;
            z-index: 1000;
            display: none;
            margin-top: 8px;
            border: 1px solid var(--light-gray);
        }

        .notifications-dropdown.active {
            display: block;
            animation: slideDown 0.2s ease;
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        .notifications-header {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .notifications-title {
            font-weight: 700;
            color: var(--black);
            font-size: 1.1rem;
        }

        .mark-all-read {
            background: none;
            border: none;
            color: var(--gold-dark);
            font-weight: 600;
            cursor: pointer;
            font-size: 0.9rem;
            padding: 4px 8px;
            border-radius: 6px;
            transition: background 0.3s ease;
        }

        .mark-all-read:hover {
            background: var(--gold-light);
        }

        .notifications-list {
            max-height: 300px;
            overflow-y: auto;
        }

        .notification-item {
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--light-gray);
            cursor: pointer;
            transition: background 0.3s ease;
        }

        .notification-item:hover {
            background: var(--gray);
        }

        .notification-item.unread {
            background: rgba(212, 175, 55, 0.05);
        }

        .notification-item.unread:hover {
            background: rgba(212, 175, 55, 0.1);
        }

        .notification-content {
            font-size: 0.95rem;
            color: var(--dark-gray);
            margin-bottom: 4px;
        }

        .notification-time {
            font-size: 0.8rem;
            color: #999;
        }

        .notification-dot {
            display: inline-block;
            width: 8px;
            height: 8px;
            background: var(--gold);
            border-radius: 50%;
            margin-right: 8px;
            vertical-align: middle;
        }

        .user-profile {
            display: flex;
            align-items: center;
            gap: 12px;
            padding: 8px 16px;
            border-radius: 24px;
            background: var(--gold-light);
            cursor: pointer;
            position: relative;
            transition: all 0.3s ease;
            border: 2px solid transparent;
        }

        .user-profile:hover {
            background: var(--gold);
            border-color: var(--gold-dark);
            transform: translateY(-2px);
        }

        .user-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--gold);
        }

        .user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .user-name {
            font-weight: 600;
            font-size: 0.95rem;
            color: var(--black);
        }

        /* ENHANCED USER DROPDOWN */
        .user-dropdown {
            position: absolute;
            top: 100%;
            right: 0;
            background: white;
            border-radius: 16px;
            box-shadow: 0 10px 40px var(--shadow);
            min-width: 240px;
            z-index: 1000;
            display: none;
            margin-top: 8px;
            overflow: hidden;
            border: 1px solid var(--light-gray);
            animation: slideDown 0.2s ease;
        }

        .user-dropdown.active {
            display: block;
        }

        .dropdown-stats {
            display: flex;
            justify-content: space-around;
            padding: 1rem;
            background: var(--gray);
            border-bottom: 1px solid var(--light-gray);
        }

        .dropdown-stat {
            text-align: center;
        }

        .dropdown-stat-value {
            font-size: 1.2rem;
            font-weight: 700;
            color: var(--gold-dark);
            display: block;
        }

        .dropdown-stat-label {
            font-size: 0.8rem;
            color: var(--dark-gray);
            display: block;
        }

        .dropdown-item {
            padding: 16px 20px;
            display: flex;
            align-items: center;
            gap: 12px;
            cursor: pointer;
            transition: background-color 0.2s;
            border-bottom: 1px solid var(--light-gray);
            color: var(--dark-gray);
            font-size: 0.95rem;
        }

        .dropdown-item:last-child {
            border-bottom: none;
        }

        .dropdown-item:hover {
            background-color: var(--gold-light);
            color: var(--black);
        }

        .dropdown-item i {
            width: 20px;
            text-align: center;
            color: var(--gold-dark);
            font-size: 1rem;
        }

        /* MAIN CONTENT */
        .container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 1.5rem;
        }

        /* LIBRARY HEADER */
        .library-header {
            margin: 2rem 0 1.5rem 0;
            text-align: center;
        }

        .library-title {
            font-size: 2.2rem;
            color: var(--gold-dark);
            font-weight: 800;
            margin-bottom: 0.5rem;
            position: relative;
            display: inline-block;
        }

        .library-title:after {
            content: '';
            position: absolute;
            bottom: -10px;
            left: 50%;
            transform: translateX(-50%);
            width: 80px;
            height: 4px;
            background: linear-gradient(to right, var(--gold), var(--gold-dark));
            border-radius: 2px;
        }

        .library-subtitle {
            font-size: 1.1rem;
            color: var(--dark-gray);
            margin-top: 1.5rem;
            max-width: 600px;
            margin-left: auto;
            margin-right: auto;
            line-height: 1.7;
        }

        /* READING STATS */
        .reading-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .reading-stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .reading-stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .reading-stat-icon {
            width: 50px;
            height: 50px;
            background: var(--gold-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.3rem;
            color: var(--gold-dark);
        }

        .reading-stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gold-dark);
            margin-bottom: 0.5rem;
        }

        .reading-stat-label {
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        /* READING PROGRESS */
        .reading-progress {
            margin: 2rem 0;
            padding: 1.5rem;
            background: white;
            border-radius: 16px;
            box-shadow: var(--card-shadow);
            display: none;
        }

        .progress-bar {
            height: 8px;
            background: var(--light-gray);
            border-radius: 4px;
            overflow: hidden;
            margin: 1rem 0;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, var(--gold), var(--gold-dark));
            border-radius: 4px;
            transition: width 0.3s ease;
        }

        .progress-stats {
            display: flex;
            justify-content: space-between;
            font-size: 0.9rem;
            color: var(--dark-gray);
        }

        /* MEMBERSHIP INFO */
        .membership-info {
            background: linear-gradient(135deg, var(--gold-light), #fef3c7);
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            border: 2px solid var(--gold);
            display: flex;
            align-items: center;
            justify-content: space-between;
            flex-wrap: wrap;
            gap: 1rem;
        }

        .membership-details {
            flex: 1;
            min-width: 300px;
        }

        .membership-tier {
            display: flex;
            align-items: center;
            gap: 10px;
            margin-bottom: 0.5rem;
        }

        .tier-badge {
            background: var(--gold-dark);
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
        }

        .tier-name {
            font-weight: 700;
            color: var(--gold-dark);
            font-size: 1.2rem;
        }

        .membership-stats {
            display: flex;
            gap: 1.5rem;
            flex-wrap: wrap;
            margin-top: 1rem;
        }

        .stat-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            padding: 0.8rem 1.2rem;
            background: white;
            border-radius: 10px;
            min-width: 120px;
        }

        .stat-value {
            font-size: 1.8rem;
            font-weight: 800;
            color: var(--gold-dark);
        }

        .stat-label {
            font-size: 0.85rem;
            color: var(--dark-gray);
            text-align: center;
        }

        .upgrade-prompt {
            background: white;
            padding: 1.2rem 1.8rem;
            border-radius: 12px;
            text-align: center;
            border: 1px solid var(--gold);
        }

        .upgrade-prompt h4 {
            color: var(--gold-dark);
            margin-bottom: 0.5rem;
        }

        .upgrade-btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 0.8rem;
            display: inline-block;
        }

        .upgrade-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.3);
        }

        /* CATEGORY BADGES */
        .category-badges {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 2rem;
        }

        .category-badge {
            padding: 10px 20px;
            border-radius: 25px;
            background: var(--gray);
            color: var(--dark-gray);
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .category-badge.active {
            background: var(--gold);
            color: var(--black);
        }

        .category-badge:hover:not(.active) {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .category-badge i {
            font-size: 1rem;
        }

        /* FILTERS SECTION */
        .filters-section {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin-bottom: 2rem;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--light-gray);
        }

        .filter-tabs {
            display: flex;
            flex-wrap: wrap;
            gap: 10px;
            margin-bottom: 1.5rem;
        }

        .filter-tab {
            padding: 10px 24px;
            border: 2px solid var(--light-gray);
            background: white;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
            border: none;
        }

        .filter-tab.active {
            background: var(--gold);
            border-color: var(--gold);
            color: var(--black);
        }

        .filter-tab:hover:not(.active) {
            border-color: var(--gold);
            color: var(--gold-dark);
        }

        .filter-controls {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
        }

        .filter-group {
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .filter-group label {
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .filter-group select {
            padding: 12px 16px;
            border: 2px solid var(--light-gray);
            border-radius: 10px;
            font-size: 0.95rem;
            outline: none;
            background: white;
            transition: all 0.3s ease;
        }

        .filter-group select:focus {
            border-color: var(--gold);
            box-shadow: 0 0 0 3px rgba(212, 175, 55, 0.1);
        }

        /* READING GROUPS */
        .reading-groups {
            background: white;
            border-radius: 16px;
            padding: 1.5rem;
            margin: 2rem 0;
            box-shadow: var(--card-shadow);
        }

        .groups-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .group-card {
            background: var(--background);
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .group-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .group-icon {
            width: 60px;
            height: 60px;
            background: var(--gold-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: var(--gold-dark);
        }

        .join-group-btn {
            background: var(--gold);
            color: var(--black);
            border: none;
            padding: 8px 16px;
            border-radius: 20px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
        }

        .join-group-btn:hover {
            background: var(--gold-dark);
            transform: translateY(-2px);
        }

        /* BOOK RECOMMENDATIONS */
        .recommendations-section {
            margin: 3rem 0;
        }

        .recommendations-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1.5rem;
            margin-top: 1.5rem;
        }

        .recommendation-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            border: 1px solid var(--light-gray);
        }

        .recommendation-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .recommendation-cover {
            width: 120px;
            height: 160px;
            margin: 0 auto 1rem;
            border-radius: 8px;
            overflow: hidden;
        }

        .recommendation-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        /* MY BOOKS SECTION */
        .my-books-section {
            margin: 3rem 0;
        }

        .section-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 1.5rem;
        }

        .section-title {
            font-size: 1.5rem;
            color: var(--gold-dark);
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .view-all-btn {
            background: var(--gold-light);
            color: var(--gold-dark);
            border: none;
            padding: 8px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .view-all-btn:hover {
            background: var(--gold);
            transform: translateY(-2px);
        }

        .borrowed-books {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .borrowed-book-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            border: 2px solid var(--gold-light);
            display: flex;
            gap: 1rem;
            align-items: center;
            box-shadow: var(--card-shadow);
        }

        .borrowed-book-cover {
            width: 80px;
            height: 100px;
            border-radius: 8px;
            overflow: hidden;
            flex-shrink: 0;
        }

        .borrowed-book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .borrowed-book-info {
            flex: 1;
        }

        .borrowed-book-title {
            font-weight: 700;
            color: var(--gold-dark);
            margin-bottom: 0.5rem;
        }

        .due-date {
            color: var(--borrowed);
            font-weight: 600;
            font-size: 0.9rem;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .borrowed-actions {
            display: flex;
            gap: 8px;
        }

        .renew-btn {
            background: var(--gold-light);
            color: var(--gold-dark);
            border: none;
            padding: 8px 16px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            font-size: 0.85rem;
            transition: all 0.3s ease;
        }

        .renew-btn:hover:not(:disabled) {
            background: var(--gold);
            transform: translateY(-2px);
        }

        .renew-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        /* LIBRARY GRID */
        .library-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
            margin-bottom: 3rem;
        }

        /* BOOK CARD */
        .book-card {
            background: var(--white);
            border: 1px solid var(--light-gray);
            border-radius: 16px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
            position: relative;
            height: 100%;
            display: flex;
            flex-direction: column;
        }

        .book-card:hover {
            transform: translateY(-6px);
            box-shadow: var(--hover-shadow);
        }

        .book-card.featured {
            border: 3px solid var(--gold);
        }

        .featured-badge {
            position: absolute;
            top: 15px;
            right: 15px;
            background: var(--gold);
            color: var(--black);
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
            display: flex;
            align-items: center;
            gap: 6px;
        }

        .availability-badge {
            position: absolute;
            top: 15px;
            left: 15px;
            padding: 6px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            z-index: 2;
            color: white;
        }

        .available {
            background: var(--available);
        }

        .borrowed {
            background: var(--borrowed);
        }

        .reserved {
            background: var(--reserved);
        }

        .digital-only {
            background: var(--digital);
        }

        .book-cover {
            height: 200px;
            width: 100%;
            overflow: hidden;
            position: relative;
        }

        .book-cover img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .book-card:hover .book-cover img {
            transform: scale(1.05);
        }

        .book-content {
            padding: 1.5rem;
            flex: 1;
            display: flex;
            flex-direction: column;
        }

        .book-category {
            display: inline-block;
            padding: 4px 10px;
            border-radius: 12px;
            font-size: 0.75rem;
            font-weight: 700;
            margin-bottom: 0.8rem;
            align-self: flex-start;
        }

        .fiction {
            background: rgba(155, 89, 182, 0.1);
            color: var(--fiction);
        }

        .non-fiction {
            background: rgba(230, 126, 34, 0.1);
            color: var(--non-fiction);
        }

        .business {
            background: rgba(26, 188, 156, 0.1);
            color: var(--business);
        }

        .personal-growth {
            background: rgba(52, 152, 219, 0.1);
            color: #3498db;
        }

        .finance {
            background: rgba(46, 204, 113, 0.1);
            color: #27ae60;
        }

        .book-title {
            font-size: 1.2rem;
            color: var(--gold-dark);
            margin-bottom: 0.5rem;
            line-height: 1.3;
            font-weight: 700;
            flex: 1;
        }

        .book-author {
            color: var(--dark-gray);
            font-size: 0.9rem;
            margin-bottom: 0.8rem;
        }

        .book-rating {
            display: flex;
            align-items: center;
            gap: 6px;
            margin-bottom: 1rem;
        }

        .stars {
            color: var(--gold);
        }

        .rating-value {
            font-weight: 600;
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        .book-meta-small {
            display: flex;
            gap: 1rem;
            margin-bottom: 1rem;
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        /* SOCIAL ACTIONS IN BOOK CARD */
        .book-social-actions-small {
            display: flex;
            gap: 10px;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }

        .social-action-btn-small {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.85rem;
            border: none;
            display: flex;
            align-items: center;
            gap: 6px;
            flex: 1;
            justify-content: center;
            background: var(--gray);
            color: var(--dark-gray);
            border: 1px solid var(--light-gray);
        }

        .social-action-btn-small:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        .social-action-btn-small.liked {
            background: rgba(231, 76, 60, 0.1);
            color: #e74c3c;
            border-color: rgba(231, 76, 60, 0.2);
        }

        .social-action-btn-small.saved {
            background: rgba(212, 175, 55, 0.1);
            color: var(--gold-dark);
            border-color: rgba(212, 175, 55, 0.2);
        }

        .book-actions {
            display: flex;
            gap: 10px;
            margin-top: auto;
            padding-top: 1rem;
            border-top: 1px solid var(--light-gray);
        }

        .book-action-btn {
            padding: 10px 16px;
            border-radius: 8px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
            border: none;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            flex: 1;
        }

        .borrow-book-btn {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
        }

        .borrow-book-btn:hover:not(:disabled) {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .borrow-book-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
        }

        .details-btn {
            background: var(--gray);
            color: var(--dark-gray);
            border: 1px solid var(--light-gray);
        }

        .details-btn:hover {
            background: var(--light-gray);
            transform: translateY(-2px);
        }

        /* QUICK STATS */
        .quick-stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }

        .stat-card {
            background: white;
            border-radius: 12px;
            padding: 1.5rem;
            text-align: center;
            box-shadow: var(--card-shadow);
            border: 1px solid var(--light-gray);
            transition: all 0.3s ease;
        }

        .stat-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .stat-icon {
            width: 60px;
            height: 60px;
            background: var(--gold-light);
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            margin: 0 auto 1rem;
            font-size: 1.5rem;
            color: var(--gold-dark);
        }

        .stat-number {
            font-size: 2rem;
            font-weight: 800;
            color: var(--gold-dark);
            margin-bottom: 0.5rem;
        }

        .stat-text {
            color: var(--dark-gray);
            font-size: 0.9rem;
        }

        /* ARTICLES SECTION */
        .articles-section {
            margin: 3rem 0;
        }

        .articles-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(300px, 1fr));
            gap: 1.5rem;
        }

        .article-card {
            background: white;
            border-radius: 12px;
            overflow: hidden;
            box-shadow: var(--card-shadow);
            transition: all 0.3s ease;
        }

        .article-card:hover {
            transform: translateY(-4px);
            box-shadow: var(--hover-shadow);
        }

        .article-image {
            height: 160px;
            width: 100%;
            overflow: hidden;
        }

        .article-image img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }

        .article-card:hover .article-image img {
            transform: scale(1.05);
        }

        .article-content {
            padding: 1.5rem;
        }

        .article-title {
            font-size: 1.1rem;
            color: var(--gold-dark);
            margin-bottom: 0.8rem;
            line-height: 1.3;
        }

        .article-excerpt {
            color: var(--dark-gray);
            font-size: 0.9rem;
            line-height: 1.6;
            margin-bottom: 1rem;
            display: -webkit-box;
            -webkit-line-clamp: 3;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }

        .article-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            font-size: 0.85rem;
            color: var(--dark-gray);
        }

        .read-time {
            display: flex;
            align-items: center;
            gap: 6px;
        }

        /* LOADING AND EMPTY STATES */
        .loading {
            text-align: center;
            padding: 4rem;
            color: var(--gold-dark);
            grid-column: 1 / -1;
        }

        .loading-spinner {
            border: 4px solid var(--gold-light);
            border-top: 4px solid var(--gold);
            border-radius: 50%;
            width: 48px;
            height: 48px;
            animation: spin 1s linear infinite;
            margin: 0 auto 1.5rem;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .empty-state {
            text-align: center;
            padding: 4rem;
            color: var(--dark-gray);
            grid-column: 1 / -1;
        }

        .empty-state i {
            font-size: 3.5rem;
            color: var(--gold-light);
            margin-bottom: 1.5rem;
        }

        .empty-state h3 {
            font-size: 1.4rem;
            margin-bottom: 0.8rem;
            color: var(--gold-dark);
        }

        /* NOTIFICATION */
        .notification {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--black);
            color: white;
            padding: 14px 24px;
            border-radius: 12px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s ease;
            max-width: 300px;
            box-shadow: 0 8px 25px var(--shadow);
            font-weight: 500;
        }

        .notification.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification.error {
            background: #e74c3c;
        }

        .notification.success {
            background: var(--gold);
            color: var(--black);
        }

        .notification.info {
            background: #3498db;
        }

        /* ENHANCED BOTTOM NAVIGATION */
        .bottom-nav {
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background-color: var(--white);
            display: flex;
            justify-content: space-around;
            padding: 0.8rem 0;
            z-index: 100;
            border-top: 1px solid var(--light-gray);
            backdrop-filter: blur(10px);
            box-shadow: 0 -2px 15px rgba(0, 0, 0, 0.08);
            transition: transform 0.3s ease;
        }

        .bottom-nav.hidden {
            transform: translateY(100%);
        }

        .nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--dark-gray);
            text-decoration: none;
            font-size: 0.85rem;
            transition: all 0.3s ease;
            position: relative;
            padding: 8px 12px;
            border-radius: 12px;
        }

        .nav-icon {
            font-size: 1.4rem;
            margin-bottom: 4px;
        }

        .nav-item.active {
            color: var(--gold-dark);
            background: var(--gold-light);
            font-weight: 600;
        }

        .nav-item:hover {
            color: var(--gold-dark);
            transform: translateY(-3px);
        }

        .nav-badge {
            position: absolute;
            top: -5px;
            right: -5px;
            background: #e74c3c;
            color: white;
            font-size: 0.7rem;
            width: 18px;
            height: 18px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        /* RESPONSIVE DESIGN */
        @media (max-width: 992px) {
            .library-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            }
            
            .borrowed-books,
            .articles-grid,
            .groups-grid,
            .recommendations-grid {
                grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            }
            
            .membership-info {
                flex-direction: column;
                text-align: center;
            }
            
            .membership-details {
                min-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .search-container {
                display: none;
            }
            
            .user-name {
                display: none;
            }
            
            .user-profile {
                padding: 8px;
            }
            
            .filter-tabs {
                justify-content: center;
            }
            
            .filter-controls {
                grid-template-columns: 1fr;
            }
            
            .library-grid {
                grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            }
            
            .book-modal-body {
                grid-template-columns: 1fr;
            }
            
            .book-cover-large {
                height: 300px;
                margin: 0 auto;
                max-width: 300px;
            }
            
            .book-actions {
                flex-direction: column;
            }
            
            .section-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
            
            .borrowed-book-card {
                flex-direction: column;
                text-align: center;
            }
            
            .borrowed-actions {
                justify-content: center;
            }
            
            .notifications-dropdown {
                width: 280px;
                right: -20px;
            }
            
            .reading-stats {
                grid-template-columns: repeat(2, 1fr);
            }
            
            .quick-stats {
                grid-template-columns: repeat(2, 1fr);
            }
        }

        @media (max-width: 480px) {
            .brand-subtitle {
                display: none;
            }
            
            .library-title {
                font-size: 1.8rem;
            }
            
            .library-subtitle {
                font-size: 1rem;
            }
            
            .filter-tab {
                padding: 8px 16px;
                font-size: 0.9rem;
            }
            
            .library-grid {
                grid-template-columns: 1fr;
            }
            
            .stat-item {
                min-width: 100px;
                padding: 0.6rem 0.8rem;
            }
            
            .bottom-nav {
                padding: 0.6rem 0;
            }
            
            .nav-item {
                font-size: 0.75rem;
                padding: 6px 8px;
            }
            
            .nav-icon {
                font-size: 1.2rem;
            }
            
            .reading-stats,
            .quick-stats {
                grid-template-columns: 1fr;
            }
            
            .category-badges {
                justify-content: center;
            }
        }

        /* SCROLLBAR STYLING */
        ::-webkit-scrollbar {
            width: 8px;
        }

        ::-webkit-scrollbar-track {
            background: transparent;
        }

        ::-webkit-scrollbar-thumb {
            background: var(--gold);
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: var(--gold-dark);
        }

        /* UTILITY CLASSES */
        .hidden {
            display: none !important;
        }
    </style>
</head>
<body>
    <!-- Back to Top Button -->
    <button class="back-to-top" id="backToTop" onclick="scrollToTop()">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Notification -->
    <div class="notification" id="notification"></div>

    <!-- Sign In Modal -->
    <div class="signin-modal" id="signinModal">
        <div class="signin-content">
            <div class="signin-header">
                <h2>Welcome to THE SONGA Library</h2>
                <p>UNBOUND | UNBENT | UNBROKEN</p>
                <button class="close-signin-modal" id="closeSigninModal">&times;</button>
            </div>
            <div class="signin-body">
                <p>Sign in to access our library, borrow books, track your reading, and join reading groups.</p>
                
                <div class="google-signin-container">
                    <div id="g_id_onload"
                         data-client_id="123922889572-9dmjivsoese0b0o78poo5mgu7nqqm6e6.apps.googleusercontent.com"
                         data-context="signin"
                         data-ux_mode="popup"
                         data-callback="handleGoogleSignIn"
                         data-auto_prompt="false">
                    </div>
                    <div class="g_id_signin"
                         data-type="standard"
                         data-shape="rectangular"
                         data-theme="outline"
                         data-text="signin_with"
                         data-size="large"
                         data-logo_alignment="left">
                    </div>
                </div>
                
                <div class="signin-footer">
                    By signing in, you agree to our community guidelines and membership terms.
                </div>
            </div>
        </div>
    </div>

    <!-- Book Details Modal -->
    <div class="book-modal" id="bookModal">
        <div class="book-modal-content">
            <div class="book-modal-header">
                <h2 id="bookModalTitle">Book Title</h2>
                <p id="bookModalAuthor">by Author Name</p>
                <button class="close-book-modal" id="closeBookModal">&times;</button>
            </div>
            <div class="book-modal-body">
                <div class="book-cover-large">
                    <img id="bookModalCover" src="" alt="Book Cover">
                </div>
                <div class="book-info">
                    <div class="book-meta">
                        <div class="book-meta-item">
                            <i class="fas fa-star"></i>
                            <span id="bookModalRating">4.5</span>
                        </div>
                        <div class="book-meta-item">
                            <i class="fas fa-book"></i>
                            <span id="bookModalPages">320 pages</span>
                        </div>
                        <div class="book-meta-item">
                            <i class="fas fa-calendar"></i>
                            <span id="bookModalYear">2023</span>
                        </div>
                        <div class="book-meta-item">
                            <i class="fas fa-layer-group"></i>
                            <span id="bookModalFormat">Paperback</span>
                        </div>
                    </div>
                    
                    <div class="book-description" id="bookModalDescription">
                        Book description will appear here...
                    </div>
                    
                    <div class="book-tags" id="bookModalTags">
                        <!-- Tags will be populated here -->
                    </div>
                    
                    <div class="book-availability">
                        <div class="availability-status">
                            <span class="status-label">Availability:</span>
                            <span class="status-value" id="bookModalStatus">Available</span>
                        </div>
                        <div class="availability-details" id="bookModalAvailabilityDetails">
                            <!-- Availability details will be populated here -->
                        </div>
                    </div>
                    
                    <div class="book-actions">
                        <button class="book-action-btn borrow-btn" id="borrowFromModalBtn">
                            <i class="fas fa-book-reader"></i> Borrow Book
                        </button>
                        <button class="book-action-btn digital-btn" id="digitalAccessBtn" style="display: none;">
                            <i class="fas fa-file-pdf"></i> Digital Access
                        </button>
                        <button class="book-action-btn wishlist-btn">
                            <i class="fas fa-heart"></i> Wishlist
                        </button>
                    </div>
                    
                    <div class="book-social-actions">
                        <button class="social-action-btn" id="likeBookBtn">
                            <i class="far fa-heart"></i> Like
                        </button>
                        <button class="social-action-btn" id="saveBookBtn">
                            <i class="far fa-bookmark"></i> Save
                        </button>
                        <button class="social-action-btn" id="shareBookBtn">
                            <i class="fas fa-share-alt"></i> Share
                        </button>
                    </div>
                    
                    <div class="book-reviews" id="bookReviews">
                        <div class="section-header">
                            <h4 class="section-title">
                                <i class="fas fa-star"></i> Member Reviews
                            </h4>
                        </div>
                        <div id="reviewsList">
                            <!-- Reviews will be populated here -->
                        </div>
                        <div class="add-review" style="display: none;" id="addReviewSection">
                            <textarea id="reviewText" placeholder="Write your review..." class="post-form-input post-form-textarea" rows="3"></textarea>
                            <div class="star-rating">
                                <i class="far fa-star" data-rating="1"></i>
                                <i class="far fa-star" data-rating="2"></i>
                                <i class="far fa-star" data-rating="3"></i>
                                <i class="far fa-star" data-rating="4"></i>
                                <i class="far fa-star" data-rating="5"></i>
                            </div>
                            <button onclick="submitReview()" class="book-action-btn borrow-btn">Submit Review</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Borrow Confirmation Modal -->
    <div class="borrow-modal" id="borrowModal">
        <div class="borrow-modal-content">
            <div class="borrow-modal-header">
                <h2>Borrow Book</h2>
                <p id="borrowBookTitle">Book Title</p>
                <button class="close-borrow-modal" id="closeBorrowModal">&times;</button>
            </div>
            <div class="borrow-modal-body">
                <div class="borrow-details">
                    <div class="borrow-detail-item">
                        <span class="borrow-detail-label">Book:</span>
                        <span class="borrow-detail-value" id="borrowBookName"></span>
                    </div>
                    <div class="borrow-detail-item">
                        <span class="borrow-detail-label">Author:</span>
                        <span class="borrow-detail-value" id="borrowBookAuthor"></span>
                    </div>
                    <div class="borrow-detail-item">
                        <span class="borrow-detail-label">Borrow Period:</span>
                        <span class="borrow-detail-value" id="borrowPeriod">14 days</span>
                    </div>
                    <div class="borrow-detail-item">
                        <span class="borrow-detail-label">Due Date:</span>
                        <span class="borrow-detail-value" id="borrowDueDate"></span>
                    </div>
                    <div class="borrow-detail-item">
                        <span class="borrow-detail-label">Pickup Location:</span>
                        <span class="borrow-detail-value" id="borrowLocation"></span>
                    </div>
                </div>
                
                <div class="borrow-terms">
                    <p><strong>Borrowing Terms:</strong></p>
                    <ul style="margin-left: 1.5rem; margin-top: 0.5rem;">
                        <li>Return books on or before due date</li>
                        <li>Late returns incur daily fines of KSh 50</li>
                        <li>Maximum 2 renewals per book</li>
                        <li>Handle books with care, no writing/damage</li>
                        <li>Report lost books immediately</li>
                    </ul>
                </div>
                
                <div class="borrow-modal-footer">
                    <button class="cancel-borrow-btn" id="cancelBorrowBtn">Cancel</button>
                    <button class="confirm-borrow-btn" id="confirmBorrowBtn">Confirm Borrow</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Header -->
    <header>
        <div class="header-container">
            <div class="logo" onclick="window.location.href='index.html'">
                <img src="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp" alt="THE SONGA Logo">
                <div class="brand-info">
                    <div class="brand-name">THE SONGA</div>
                    <div class="brand-subtitle">UNBOUND | UNBENT | UNBROKEN</div>
                </div>
            </div>
            
            <div class="search-container">
                <div class="search-box">
                    <i class="fas fa-search"></i>
                    <input type="text" placeholder="Search books, authors, topics..." id="searchInput">
                </div>
            </div>
            
            <div class="auth-section">
                <!-- Notifications Button -->
                <div class="notification-btn" id="notificationBtn" onclick="toggleNotifications()">
                    <i class="fas fa-bell"></i>
                    <div class="notification-badge count hidden" id="notificationBadge">0</div>
                </div>
                
                <!-- Notifications Dropdown -->
                <div class="notifications-dropdown" id="notificationsDropdown">
                    <div class="notifications-header">
                        <h4 class="notifications-title">Notifications</h4>
                        <button class="mark-all-read" onclick="markAllNotificationsAsRead()">Mark all as read</button>
                    </div>
                    <div class="notifications-list" id="notificationsList">
                        <div class="notification-item unread">
                            <div class="notification-content">
                                <span class="notification-dot"></span>
                                Welcome to THE SONGA Library!
                            </div>
                            <div class="notification-time">2 hours ago</div>
                        </div>
                    </div>
                </div>
                
                <!-- User Profile -->
                <div id="userProfile" class="user-profile" style="display: none;">
                    <div class="user-avatar">
                        <img id="userAvatar" src="" alt="User Avatar">
                    </div>
                    <div class="user-name" id="userDisplayName"></div>
                    <div class="user-dropdown" id="userDropdown">
                        <div class="dropdown-stats">
                            <div class="dropdown-stat">
                                <span class="dropdown-stat-value" id="dropdownBooksBorrowed">0</span>
                                <span class="dropdown-stat-label">Books</span>
                            </div>
                            <div class="dropdown-stat">
                                <span class="dropdown-stat-value" id="dropdownReadingTime">0h</span>
                                <span class="dropdown-stat-label">Reading</span>
                            </div>
                        </div>
                        <div class="dropdown-item" onclick="window.location.href='profile.html'">
                            <i class="fas fa-user"></i>
                            <span>My Profile</span>
                        </div>
                        <div class="dropdown-item" onclick="showMyBooks()">
                            <i class="fas fa-book"></i>
                            <span>My Books</span>
                        </div>
                        <div class="dropdown-item" onclick="showWishlist()">
                            <i class="fas fa-heart"></i>
                            <span>Wishlist</span>
                        </div>
                        <div class="dropdown-item" onclick="showReadingStats()">
                            <i class="fas fa-chart-line"></i>
                            <span>Reading Stats</span>
                        </div>
                        <div class="dropdown-item" id="signOutOption">
                            <i class="fas fa-sign-out-alt"></i>
                            <span>Sign Out</span>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container">
        <div class="library-header">
            <h1 class="library-title">Knowledge Library</h1>
            <p class="library-subtitle">
                Access our curated collection of books and articles on personal growth, business, 
                finance, and spirituality. Expand your knowledge with THE SONGA.
            </p>
        </div>

        <!-- Reading Stats -->
        <div class="reading-stats" id="readingStats" style="display: none;">
            <div class="reading-stat-card">
                <div class="reading-stat-icon">
                    <i class="fas fa-book-reader"></i>
                </div>
                <div class="reading-stat-value" id="totalReadingTime">0h</div>
                <div class="reading-stat-label">Total Reading</div>
            </div>
            <div class="reading-stat-card">
                <div class="reading-stat-icon">
                    <i class="fas fa-fire"></i>
                </div>
                <div class="reading-stat-value" id="currentStreak">0</div>
                <div class="reading-stat-label">Day Streak</div>
            </div>
            <div class="reading-stat-card">
                <div class="reading-stat-icon">
                    <i class="fas fa-trophy"></i>
                </div>
                <div class="reading-stat-value" id="booksCompleted">0</div>
                <div class="reading-stat-label">Books Read</div>
            </div>
            <div class="reading-stat-card">
                <div class="reading-stat-icon">
                    <i class="fas fa-award"></i>
                </div>
                <div class="reading-stat-value" id="achievements">0</div>
                <div class="reading-stat-label">Achievements</div>
            </div>
        </div>

        <!-- Reading Progress -->
        <div class="reading-progress" id="currentReadingProgress" style="display: none;">
            <div class="section-header">
                <h3 class="section-title">
                    <i class="fas fa-spinner"></i> Currently Reading
                </h3>
            </div>
            <div id="currentBookProgress">
                <!-- Will be populated by JavaScript -->
            </div>
        </div>

        <!-- Quick Stats -->
        <div class="quick-stats" id="quickStats">
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-book"></i>
                </div>
                <div class="stat-number" id="totalBooks">0</div>
                <div class="stat-text">Books Available</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-user-graduate"></i>
                </div>
                <div class="stat-number" id="totalBorrows">0</div>
                <div class="stat-text">Books Borrowed</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-newspaper"></i>
                </div>
                <div class="stat-number" id="totalArticles">0</div>
                <div class="stat-text">Articles</div>
            </div>
            <div class="stat-card">
                <div class="stat-icon">
                    <i class="fas fa-users"></i>
                </div>
                <div class="stat-number" id="activeReaders">0</div>
                <div class="stat-text">Active Readers</div>
            </div>
        </div>

        <!-- Membership Info -->
        <div class="membership-info" id="membershipInfo" style="display: none;">
            <div class="membership-details">
                <div class="membership-tier">
                    <span class="tier-badge" id="tierBadge">EXPLORER</span>
                    <span class="tier-name" id="tierName">Explorer Plan</span>
                </div>
                <p id="tierDescription">Basic access to community and limited library resources</p>
                <div class="membership-stats">
                    <div class="stat-item">
                        <div class="stat-value" id="booksBorrowed">0</div>
                        <div class="stat-label">Books Borrowed</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="booksLimit">5</div>
                        <div class="stat-label">Monthly Limit</div>
                    </div>
                    <div class="stat-item">
                        <div class="stat-value" id="renewalsLeft">0</div>
                        <div class="stat-label">Renewals Left</div>
                    </div>
                </div>
            </div>
            <div class="upgrade-prompt">
                <h4>Upgrade for More Access</h4>
                <p>Get unlimited books, priority access, and exclusive content</p>
                <button class="upgrade-btn" onclick="showUpgradeOptions()">
                    <i class="fas fa-crown"></i> Upgrade Now
                </button>
            </div>
        </div>

        <!-- Category Badges -->
        <div class="category-badges" id="categoryBadges">
            <div class="category-badge active" data-category="all">
                <i class="fas fa-th-large"></i> All Books
            </div>
            <div class="category-badge" data-category="business">
                <i class="fas fa-briefcase"></i> Business
            </div>
            <div class="category-badge" data-category="finance">
                <i class="fas fa-chart-line"></i> Finance
            </div>
            <div class="category-badge" data-category="personal-growth">
                <i class="fas fa-brain"></i> Personal Growth
            </div>
            <div class="category-badge" data-category="non-fiction">
                <i class="fas fa-book-open"></i> Non-Fiction
            </div>
            <div class="category-badge" data-category="fiction">
                <i class="fas fa-theater-masks"></i> Fiction
            </div>
        </div>

        <!-- Filters Section -->
        <div class="filters-section">
            <div class="filter-tabs" id="filterTabs">
                <button class="filter-tab active" data-filter="all">
                    All Books
                    <span class="count" id="countAll">0</span>
                </button>
                <button class="filter-tab" data-filter="available">
                    <i class="fas fa-check-circle"></i> Available
                    <span class="count" id="countAvailable">0</span>
                </button>
                <button class="filter-tab" data-filter="featured">
                    <i class="fas fa-star"></i> Featured
                    <span class="count" id="countFeatured">0</span>
                </button>
                <button class="filter-tab" data-filter="digital">
                    <i class="fas fa-file-pdf"></i> Digital
                    <span class="count" id="countDigital">0</span>
                </button>
            </div>
            
            <div class="filter-controls">
                <div class="filter-group">
                    <label for="sortFilter"><i class="fas fa-sort"></i> Sort By</label>
                    <select id="sortFilter">
                        <option value="popularity">Most Popular</option>
                        <option value="title">Title A-Z</option>
                        <option value="author">Author A-Z</option>
                        <option value="rating">Highest Rated</option>
                        <option value="date-added">Recently Added</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="availabilityFilter"><i class="fas fa-filter"></i> Availability</label>
                    <select id="availabilityFilter">
                        <option value="all">All Status</option>
                        <option value="available">Available Now</option>
                        <option value="borrowed">Currently Borrowed</option>
                        <option value="digital">Digital Only</option>
                    </select>
                </div>
                
                <div class="filter-group">
                    <label for="formatFilter"><i class="fas fa-book"></i> Format</label>
                    <select id="formatFilter">
                        <option value="all">All Formats</option>
                        <option value="physical">Physical Books</option>
                        <option value="digital">Digital Books</option>
                        <option value="both">Both Formats</option>
                    </select>
                </div>
            </div>
        </div>

        <!-- Reading Groups -->
        <div class="reading-groups">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-users"></i> Reading Groups
                </h2>
                <button class="view-all-btn" onclick="showAllGroups()">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            <div class="groups-grid" id="readingGroups">
                <!-- Groups will be populated here -->
            </div>
        </div>

        <!-- My Books Section -->
        <div class="my-books-section" id="myBooksSection" style="display: none;">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-bookmark"></i> My Books
                </h2>
                <button class="view-all-btn" onclick="showAllBorrowedBooks()">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div class="borrowed-books" id="borrowedBooksList">
                <!-- Borrowed books will be populated here -->
            </div>
        </div>

        <!-- Library Grid -->
        <div class="library-grid" id="libraryGrid">
            <div class="loading">
                <div class="loading-spinner"></div>
                <p>Loading library books...</p>
            </div>
        </div>

        <!-- Book Recommendations -->
        <div class="recommendations-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-lightbulb"></i> Recommended For You
                </h2>
                <button class="view-all-btn" onclick="refreshRecommendations()">
                    <i class="fas fa-sync-alt"></i> Refresh
                </button>
            </div>
            <div class="recommendations-grid" id="bookRecommendations">
                <!-- Recommendations will be populated here -->
            </div>
        </div>

        <!-- Articles Section -->
        <div class="articles-section">
            <div class="section-header">
                <h2 class="section-title">
                    <i class="fas fa-newspaper"></i> Featured Articles
                </h2>
                <button class="view-all-btn">
                    View All <i class="fas fa-arrow-right"></i>
                </button>
            </div>
            
            <div class="articles-grid" id="articlesGrid">
                <!-- Articles will be populated here -->
            </div>
        </div>

        <!-- Empty State Template -->
        <template id="emptyStateTemplate">
            <div class="empty-state">
                <i class="fas fa-book-open"></i>
                <h3>No Books Found</h3>
                <p>Try adjusting your filters or check back for new additions to our library.</p>
            </div>
        </template>
    </main>

    <!-- Bottom Navigation -->
    <nav class="bottom-nav" id="bottomNav">
        <a href="index.html" class="nav-item">
            <i class="fas fa-home nav-icon"></i>
            <span>Feed</span>
        </a>
        <a href="events.html" class="nav-item">
            <i class="fas fa-calendar-alt nav-icon"></i>
            <span>Events</span>
        </a>
        <a href="library.html" class="nav-item active">
            <i class="fas fa-book nav-icon"></i>
            <span>Library</span>
            <span class="nav-badge" id="libraryBadge" style="display: none;">3</span>
        </a>
        <a href="profile.html" class="nav-item">
            <i class="fas fa-user nav-icon"></i>
            <span>Profile</span>
        </a>
    </nav>

    <!-- Firebase and Google Sign-In SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async></script>

    <script>
        // Firebase configuration
        const firebaseConfig = {
            apiKey: "AIzaSyBDZicoo7dFLtSmgRPvQE_gdm-tNOyCTXA",
            authDomain: "the-songa-77b1b.firebaseapp.com",
            databaseURL: "https://the-songa-77b1b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "the-songa-77b1b",
            storageBucket: "the-songa-77b1b.firebasestorage.app",
            messagingSenderId: "123922889572",
            appId: "1:123922889572:web:482b2a624930baaf92d871"
        };

        // Initialize Firebase
        let database;
        try {
            firebase.initializeApp(firebaseConfig);
            database = firebase.database();
            console.log("Firebase initialized successfully for library");
        } catch (error) {
            console.error("Firebase initialization error:", error);
            document.getElementById('libraryGrid').innerHTML = `
                <div class="empty-state">
                    <i class="fas fa-exclamation-triangle"></i>
                    <h3>Connection Error</h3>
                    <p>Unable to connect to database. Please refresh the page.</p>
                </div>
            `;
        }

        // Global variables
        let currentUser = null;
        let currentUserData = null;
        let books = [];
        let articles = [];
        let filteredBooks = [];
        let selectedBook = null;
        let userBorrowedBooks = [];
        let userNotifications = [];
        let userReadingStats = {};
        let likedBooks = [];
        let savedBooks = [];
        let readingGroups = [];
        let bookRecommendations = [];
        let dropdownOpen = false;
        let subscriptionPlans = {};
        
        // Scroll handling variables
        let lastScrollTop = 0;
        let isBottomNavVisible = true;
        let isBackToTopVisible = false;

        // DOM Elements
        const signinModal = document.getElementById('signinModal');
        const bookModal = document.getElementById('bookModal');
        const borrowModal = document.getElementById('borrowModal');
        const userProfile = document.getElementById('userProfile');
        const userAvatar = document.getElementById('userAvatar');
        const userDisplayName = document.getElementById('userDisplayName');
        const notification = document.getElementById('notification');
        const libraryGrid = document.getElementById('libraryGrid');
        const membershipInfo = document.getElementById('membershipInfo');
        const myBooksSection = document.getElementById('myBooksSection');
        const articlesGrid = document.getElementById('articlesGrid');
        const quickStats = document.getElementById('quickStats');
        const backToTop = document.getElementById('backToTop');
        const bottomNav = document.getElementById('bottomNav');
        const notificationBtn = document.getElementById('notificationBtn');
        const notificationsDropdown = document.getElementById('notificationsDropdown');
        const notificationBadge = document.getElementById('notificationBadge');
        const libraryBadge = document.getElementById('libraryBadge');

        // Show notification
        function showNotification(message, type = 'success', duration = 4000) {
            const notification = document.getElementById('notification');
            notification.textContent = message;
            notification.className = `notification show ${type}`;
            setTimeout(() => {
                notification.classList.remove('show');
            }, duration);
        }

        // Scroll handling
        function handleScroll() {
            const scrollTop = window.pageYOffset || document.documentElement.scrollTop;
            
            // Show/hide back to top button
            if (scrollTop > 300) {
                if (!isBackToTopVisible) {
                    backToTop.classList.add('visible');
                    isBackToTopVisible = true;
                }
            } else {
                if (isBackToTopVisible) {
                    backToTop.classList.remove('visible');
                    isBackToTopVisible = false;
                }
            }
            
            // Hide/show bottom nav based on scroll direction
            if (scrollTop > lastScrollTop && scrollTop > 100) {
                // Scrolling down
                if (isBottomNavVisible) {
                    bottomNav.classList.add('hidden');
                    isBottomNavVisible = false;
                }
            } else {
                // Scrolling up
                if (!isBottomNavVisible) {
                    bottomNav.classList.remove('hidden');
                    isBottomNavVisible = true;
                }
            }
            
            lastScrollTop = scrollTop <= 0 ? 0 : scrollTop;
        }

        function scrollToTop() {
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        // Notifications functions
        function toggleNotifications() {
            notificationsDropdown.classList.toggle('active');
            closeDropdown();
        }

        async function markAllNotificationsAsRead() {
            if (!currentUser || !database) return;
            
            try {
                const updates = {};
                userNotifications.forEach(notification => {
                    updates[`users/${currentUser.uid}/notifications/${notification.id}/read`] = true;
                });
                
                await database.ref().update(updates);
                showNotification('All notifications marked as read', 'success');
            } catch (error) {
                console.error('Error marking notifications as read:', error);
            }
        }

        async function setupNotifications() {
            if (!currentUser || !database) return;
            
            // Listen for notifications
            database.ref(`users/${currentUser.uid}/notifications`).on('value', (snapshot) => {
                if (snapshot.exists()) {
                    userNotifications = Object.keys(snapshot.val()).map(key => ({
                        id: key,
                        ...snapshot.val()[key]
                    }));
                    
                    updateNotificationBadge();
                    renderNotifications();
                }
            });
        }

        function updateNotificationBadge() {
            const unreadCount = userNotifications.filter(n => !n.read).length;
            
            if (notificationBadge) {
                if (unreadCount > 0) {
                    notificationBadge.textContent = unreadCount > 9 ? '9+' : unreadCount;
                    notificationBadge.classList.remove('hidden');
                } else {
                    notificationBadge.classList.add('hidden');
                }
            }
            
            // Update library-specific badge
            if (libraryBadge) {
                const libraryNotifications = userNotifications.filter(n => 
                    n.type && (n.type.includes('book') || n.type.includes('library'))
                ).length;
                
                if (libraryNotifications > 0) {
                    libraryBadge.textContent = libraryNotifications > 3 ? '3+' : libraryNotifications;
                    libraryBadge.style.display = 'flex';
                } else {
                    libraryBadge.style.display = 'none';
                }
            }
        }

        function renderNotifications() {
            const notificationsList = document.getElementById('notificationsList');
            if (!notificationsList) return;
            
            const sortedNotifications = [...userNotifications].sort((a, b) => 
                new Date(b.createdAt || b.timestamp) - new Date(a.createdAt || a.timestamp)
            );
            
            const recentNotifications = sortedNotifications.slice(0, 10);
            
            notificationsList.innerHTML = recentNotifications.map(notification => `
                <div class="notification-item ${notification.read ? '' : 'unread'}" 
                     onclick="handleNotificationClick('${notification.id}')">
                    <div class="notification-content">
                        ${!notification.read ? '<span class="notification-dot"></span>' : ''}
                        ${notification.message || 'New notification'}
                    </div>
                    <div class="notification-time">${formatTime(notification.createdAt || notification.timestamp)}</div>
                </div>
            `).join('');
        }

        function handleNotificationClick(notificationId) {
            // Mark as read
            if (currentUser && database) {
                database.ref(`users/${currentUser.uid}/notifications/${notificationId}`).update({
                    read: true
                });
            }
        }

        // User dropdown functions
        function toggleDropdown() {
            dropdownOpen = !dropdownOpen;
            const dropdown = document.getElementById('userDropdown');
            if (dropdownOpen) {
                dropdown.classList.add('active');
            } else {
                dropdown.classList.remove('active');
            }
        }

        function closeDropdown() {
            dropdownOpen = false;
            const dropdown = document.getElementById('userDropdown');
            if (dropdown) dropdown.classList.remove('active');
            if (notificationsDropdown) notificationsDropdown.classList.remove('active');
        }

        // Social features functions
        async function toggleBookLike(bookId) {
            if (!currentUser) {
                showNotification('Please sign in to like books', 'error');
                return;
            }
            
            try {
                const bookRef = database.ref(`libraryBooks/${bookId}`);
                const snapshot = await bookRef.once('value');
                const book = snapshot.val();
                
                let likedBy = book.likedBy || [];
                let likes = book.likes || 0;
                
                if (likedBy.includes(currentUser.uid)) {
                    likedBy = likedBy.filter(id => id !== currentUser.uid);
                    likes--;
                    showNotification('Book unliked', 'success', 2000);
                } else {
                    likedBy.push(currentUser.uid);
                    likes++;
                    showNotification('Book liked!', 'success', 2000);
                }
                
                await bookRef.update({
                    likedBy: likedBy,
                    likes: likes
                });
                
            } catch (error) {
                console.error('Error toggling book like:', error);
                showNotification('Error updating like status', 'error');
            }
        }

        async function addToWishlist(bookId) {
            if (!currentUser) {
                showNotification('Please sign in to save books', 'error');
                return;
            }
            
            try {
                const userRef = database.ref(`users/${currentUser.uid}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                
                let wishlist = userData.wishlist || [];
                
                if (wishlist.includes(bookId)) {
                    wishlist = wishlist.filter(id => id !== bookId);
                    showNotification('Removed from wishlist', 'success', 2000);
                } else {
                    wishlist.push(bookId);
                    showNotification('Added to wishlist!', 'success', 2000);
                }
                
                await userRef.update({ wishlist: wishlist });
                
            } catch (error) {
                console.error('Error updating wishlist:', error);
                showNotification('Error updating wishlist', 'error');
            }
        }

        async function shareBook(bookId) {
            const book = books.find(b => b.id === bookId);
            if (!book) return;
            
            const shareUrl = `${window.location.origin}/library.html?book=${bookId}`;
            const shareText = `Check out "${book.title}" by ${book.author} on THE SONGA Library!`;
            
            if (navigator.share) {
                try {
                    await navigator.share({
                        title: book.title,
                        text: shareText,
                        url: shareUrl
                    });
                    showNotification('Book shared successfully!', 'success');
                } catch (error) {
                    console.error('Error sharing:', error);
                    fallbackShare(shareText, shareUrl);
                }
            } else {
                fallbackShare(shareText, shareUrl);
            }
        }

        function fallbackShare(text, url) {
            navigator.clipboard.writeText(`${text}\n${url}`).then(() => {
                showNotification('Book link copied to clipboard!', 'success');
            });
        }

        // Reading stats
        async function updateReadingStats() {
            if (!currentUser || !database) return;
            
            try {
                const statsRef = database.ref(`users/${currentUser.uid}/readingStats`);
                const snapshot = await statsRef.once('value');
                
                if (snapshot.exists()) {
                    userReadingStats = snapshot.val();
                    displayReadingStats();
                }
                
                statsRef.on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        userReadingStats = snapshot.val();
                        displayReadingStats();
                        updateDropdownStats();
                    }
                });
                
            } catch (error) {
                console.error('Error fetching reading stats:', error);
            }
        }

        function displayReadingStats() {
            const readingStatsDiv = document.getElementById('readingStats');
            if (!readingStatsDiv) return;
            
            if (Object.keys(userReadingStats).length > 0) {
                readingStatsDiv.style.display = 'grid';
                
                document.getElementById('totalReadingTime').textContent = 
                    `${Math.floor(userReadingStats.totalReadingMinutes / 60)}h`;
                document.getElementById('currentStreak').textContent = 
                    userReadingStats.currentStreak || 0;
                document.getElementById('booksCompleted').textContent = 
                    userReadingStats.booksCompleted || 0;
                document.getElementById('achievements').textContent = 
                    userReadingStats.achievements || 0;
            }
        }

        function updateDropdownStats() {
            document.getElementById('dropdownBooksBorrowed').textContent = 
                userReadingStats?.booksBorrowed || 0;
            document.getElementById('dropdownReadingTime').textContent = 
                `${Math.floor((userReadingStats?.totalReadingMinutes || 0) / 60)}h`;
        }

        // Reading groups
        async function loadReadingGroups() {
            if (!database) return;
            
            try {
                const groupsRef = database.ref('readingGroups');
                const snapshot = await groupsRef.once('value');
                
                if (snapshot.exists()) {
                    readingGroups = Object.keys(snapshot.val()).map(key => ({
                        id: key,
                        ...snapshot.val()[key]
                    }));
                    displayReadingGroups();
                }
                
            } catch (error) {
                console.error('Error loading reading groups:', error);
            }
        }

        function displayReadingGroups() {
            const groupsGrid = document.getElementById('readingGroups');
            if (!groupsGrid) return;
            
            const activeGroups = readingGroups.filter(group => group.status === 'active').slice(0, 3);
            
            groupsGrid.innerHTML = activeGroups.map(group => `
                <div class="group-card">
                    <div class="group-icon">
                        <i class="${group.icon || 'fas fa-users'}"></i>
                    </div>
                    <h4>${group.name}</h4>
                    <p style="font-size: 0.9rem; color: var(--dark-gray); margin: 0.5rem 0;">
                        ${group.description || 'Reading group'}
                    </p>
                    <div style="font-size: 0.85rem; color: var(--dark-gray);">
                        <i class="fas fa-users"></i> ${group.memberCount || 0} members
                    </div>
                    <button class="join-group-btn" onclick="joinReadingGroup('${group.id}')">
                        ${group.members?.includes(currentUser?.uid) ? 'Joined' : 'Join Group'}
                    </button>
                </div>
            `).join('');
        }

        async function joinReadingGroup(groupId) {
            if (!currentUser) {
                showNotification('Please sign in to join reading groups', 'error');
                return;
            }
            
            try {
                const groupRef = database.ref(`readingGroups/${groupId}`);
                const snapshot = await groupRef.once('value');
                const group = snapshot.val();
                
                let members = group.members || [];
                let memberCount = group.memberCount || 0;
                
                if (members.includes(currentUser.uid)) {
                    members = members.filter(id => id !== currentUser.uid);
                    memberCount--;
                    showNotification('Left reading group', 'success');
                } else {
                    members.push(currentUser.uid);
                    memberCount++;
                    showNotification('Joined reading group!', 'success');
                }
                
                await groupRef.update({
                    members: members,
                    memberCount: memberCount
                });
                
                loadReadingGroups();
                
            } catch (error) {
                console.error('Error joining reading group:', error);
                showNotification('Error joining group', 'error');
            }
        }

        // Book recommendations
        async function loadBookRecommendations() {
            if (!currentUser || !database) return;
            
            try {
                const userRef = database.ref(`users/${currentUser.uid}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                
                const preferences = userData.readingPreferences || ['business', 'personal-growth'];
                const borrowedBooks = userData.borrowedBooks || [];
                const wishlist = userData.wishlist || [];
                
                const booksRef = database.ref('libraryBooks');
                const booksSnapshot = await booksRef.once('value');
                const allBooks = booksSnapshot.exists() ? 
                    Object.keys(booksSnapshot.val()).map(key => ({
                        id: key,
                        ...booksSnapshot.val()[key]
                    })) : [];
                
                bookRecommendations = allBooks
                    .filter(book => 
                        !borrowedBooks.includes(book.id) && 
                        !wishlist.includes(book.id)
                    )
                    .filter(book => 
                        preferences.some(pref => 
                            book.category?.toLowerCase().includes(pref) ||
                            book.tags?.some(tag => tag.toLowerCase().includes(pref))
                        )
                    )
                    .sort((a, b) => (b.rating || 0) - (a.rating || 0))
                    .slice(0, 6);
                
                displayRecommendations();
                
            } catch (error) {
                console.error('Error loading recommendations:', error);
            }
        }

        function displayRecommendations() {
            const recommendationsGrid = document.getElementById('bookRecommendations');
            if (!recommendationsGrid) return;
            
            if (bookRecommendations.length === 0) {
                recommendationsGrid.innerHTML = `
                    <div style="grid-column: 1 / -1; text-align: center; padding: 2rem; color: var(--dark-gray);">
                        <i class="fas fa-lightbulb"></i>
                        <p>Read more books to get personalized recommendations!</p>
                    </div>
                `;
                return;
            }
            
            recommendationsGrid.innerHTML = bookRecommendations.map(book => `
                <div class="recommendation-card">
                    <div class="recommendation-cover">
                        <img src="${book.coverImage || 'https://images.unsplash.com/photo-1544716278-ca5e3f4abd8c?ixlib=rb-4.0.3&auto=format&fit=crop&w=300&q=80'}" alt="${book.title}">
                    </div>
                    <h4 style="font-size: 1rem; margin-bottom: 0.5rem;">${book.title}</h4>
                    <p style="font-size: 0.85rem; color: var(--dark-gray); margin-bottom: 1rem;">${book.author}</p>
                    <button class="book-action-btn details-btn" onclick="openBookDetails('${book.id}')" style="padding: 8px 16px; font-size: 0.85rem;">
                        View Details
                    </button>
                </div>
            `).join('');
        }

        async function refreshRecommendations() {
            showNotification('Refreshing recommendations...', 'info');
            await loadBookRecommendations();
            showNotification('Recommendations updated!', 'success');
        }

        // Helper functions
        function formatTime(timestamp) {
            if (!timestamp) return 'Recently';
            const now = new Date();
            const time = new Date(timestamp);
            const diffInSeconds = Math.floor((now - time) / 1000);
            
            if (diffInSeconds < 60) return 'Just now';
            if (diffInSeconds < 3600) return `${Math.floor(diffInSeconds / 60)}m ago`;
            if (diffInSeconds < 86400) return `${Math.floor(diffInSeconds / 3600)}h ago`;
            if (diffInSeconds < 604800) return `${Math.floor(diffInSeconds / 86400)}d ago`;
            
            return time.toLocaleDateString('en-US', {
                month: 'short',
                day: 'numeric'
            });
        }

        // Initialize enhanced features
        function initializeEnhancedFeatures() {
            window.addEventListener('scroll', handleScroll, { passive: true });
            
            if (currentUser) {
                setupNotifications();
                updateReadingStats();
                loadReadingGroups();
                loadBookRecommendations();
            }
        }

        // Add your existing library functions here...
        // (Keep all your existing library functions from the previous code)

        // Initialize everything
        document.addEventListener('DOMContentLoaded', function() {
            // Initialize existing library functions
            checkAuthStatus();
            setupEventListeners();
            
            // Initialize enhanced features
            initializeEnhancedFeatures();
        });

        // Make functions globally available
        window.scrollToTop = scrollToTop;
        window.toggleNotifications = toggleNotifications;
        window.markAllNotificationsAsRead = markAllNotificationsAsRead;
        window.toggleBookLike = toggleBookLike;
        window.addToWishlist = addToWishlist;
        window.shareBook = shareBook;
        window.joinReadingGroup = joinReadingGroup;
        window.refreshRecommendations = refreshRecommendations;
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>THE SONGA - Admin Panel</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <!-- Import Firebase SDK -->
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.0/firebase-database-compat.js"></script>
    <style>
        :root {
            --primary-color: #D4AF37;
            --primary-dark: #B8941F;
            --secondary-color: #1a1a1a;
            --light-bg: #f8f9fa;
            --dark-bg: #121212;
            --sidebar-bg: #1e1e1e;
            --card-bg: #ffffff;
            --border-color: #e0e0e0;
            --text-primary: #333333;
            --text-secondary: #666666;
            --success-color: #10b981;
            --warning-color: #f59e0b;
            --danger-color: #ef4444;
            --info-color: #3b82f6;
        }

        .dark-mode {
            --light-bg: #121212;
            --card-bg: #1e1e1e;
            --border-color: #333333;
            --text-primary: #f0f0f0;
            --text-secondary: #a0a0a0;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Inter', sans-serif;
        }

        body {
            background-color: var(--light-bg);
            color: var(--text-primary);
            transition: background-color 0.3s, color 0.3s;
        }

        .admin-container {
            display: flex;
            min-height: 100vh;
        }

        /* Sidebar Styles */
        .sidebar {
            width: 260px;
            background-color: var(--sidebar-bg);
            color: white;
            padding: 20px 0;
            display: flex;
            flex-direction: column;
            position: fixed;
            height: 100vh;
            z-index: 100;
            box-shadow: 2px 0 10px rgba(0,0,0,0.1);
        }

        .logo-section {
            padding: 0 20px 30px;
            border-bottom: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .logo {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 12px;
            margin-bottom: 10px;
        }

        .logo-img {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            object-fit: contain;
        }

        .logo-text {
            font-size: 22px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .logo-subtitle {
            font-size: 12px;
            color: rgba(255,255,255,0.7);
            letter-spacing: 1px;
        }

        .nav-menu {
            flex: 1;
            padding: 20px 0;
        }

        .nav-item {
            display: flex;
            align-items: center;
            padding: 14px 25px;
            color: rgba(255,255,255,0.8);
            text-decoration: none;
            transition: all 0.3s;
            border-left: 3px solid transparent;
        }

        .nav-item:hover {
            background-color: rgba(212, 175, 55, 0.1);
            color: white;
            border-left-color: var(--primary-color);
        }

        .nav-item.active {
            background-color: rgba(212, 175, 55, 0.15);
            color: var(--primary-color);
            border-left-color: var(--primary-color);
        }

        .nav-icon {
            width: 24px;
            margin-right: 12px;
            font-size: 18px;
            text-align: center;
        }

        .nav-text {
            font-size: 15px;
            font-weight: 500;
        }

        .sidebar-footer {
            padding: 20px;
            border-top: 1px solid rgba(255,255,255,0.1);
            text-align: center;
        }

        .admin-profile {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .admin-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            object-fit: cover;
            border: 2px solid var(--primary-color);
        }

        .admin-info h4 {
            font-size: 14px;
            color: white;
            margin-bottom: 2px;
        }

        .admin-info p {
            font-size: 12px;
            color: rgba(255,255,255,0.6);
        }

        /* Main Content Styles */
        .main-content {
            flex: 1;
            margin-left: 260px;
            padding: 20px;
        }

        .top-bar {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 15px 0;
            margin-bottom: 25px;
            border-bottom: 1px solid var(--border-color);
        }

        .page-title {
            font-size: 24px;
            font-weight: 700;
            color: var(--primary-color);
        }

        .top-bar-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }

        .mode-toggle, .notification-btn {
            background: none;
            border: none;
            color: var(--text-secondary);
            font-size: 18px;
            cursor: pointer;
            padding: 8px;
            border-radius: 8px;
            transition: all 0.3s;
        }

        .mode-toggle:hover, .notification-btn:hover {
            background-color: rgba(0,0,0,0.05);
            color: var(--primary-color);
        }

        .dark-mode .mode-toggle:hover, .dark-mode .notification-btn:hover {
            background-color: rgba(255,255,255,0.1);
        }

        /* Dashboard Cards */
        .dashboard-cards {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .card {
            background-color: var(--card-bg);
            border-radius: 12px;
            padding: 24px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            transition: transform 0.3s, box-shadow 0.3s;
            border: 1px solid var(--border-color);
        }

        .card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 20px rgba(0,0,0,0.1);
        }

        .card-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }

        .card-title {
            font-size: 16px;
            font-weight: 600;
            color: var(--text-secondary);
        }

        .card-icon {
            width: 50px;
            height: 50px;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            color: white;
        }

        .users-icon { background-color: var(--info-color); }
        .posts-icon { background-color: var(--success-color); }
        .books-icon { background-color: var(--warning-color); }
        .events-icon { background-color: var(--danger-color); }

        .card-value {
            font-size: 32px;
            font-weight: 700;
            margin-bottom: 5px;
        }

        .card-change {
            font-size: 14px;
            display: flex;
            align-items: center;
            gap: 5px;
        }

        .positive {
            color: var(--success-color);
        }

        .negative {
            color: var(--danger-color);
        }

        /* Table Styles */
        .table-container {
            background-color: var(--card-bg);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 4px 12px rgba(0,0,0,0.05);
            margin-bottom: 30px;
            border: 1px solid var(--border-color);
        }

        .table-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 20px 24px;
            border-bottom: 1px solid var(--border-color);
        }

        .table-title {
            font-size: 18px;
            font-weight: 600;
        }

        .table-actions {
            display: flex;
            gap: 10px;
        }

        .btn {
            padding: 8px 16px;
            border-radius: 8px;
            border: none;
            font-weight: 500;
            cursor: pointer;
            display: inline-flex;
            align-items: center;
            gap: 8px;
            transition: all 0.3s;
        }

        .btn-primary {
            background-color: var(--primary-color);
            color: white;
        }

        .btn-primary:hover {
            background-color: var(--primary-dark);
        }

        .btn-secondary {
            background-color: transparent;
            color: var(--text-primary);
            border: 1px solid var(--border-color);
        }

        .btn-secondary:hover {
            background-color: rgba(0,0,0,0.05);
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 14px;
        }

        .btn-icon {
            font-size: 14px;
        }

        table {
            width: 100%;
            border-collapse: collapse;
        }

        th {
            text-align: left;
            padding: 16px 24px;
            background-color: rgba(0,0,0,0.03);
            font-weight: 600;
            color: var(--text-secondary);
            font-size: 14px;
            border-bottom: 1px solid var(--border-color);
        }

        .dark-mode th {
            background-color: rgba(255,255,255,0.05);
        }

        td {
            padding: 16px 24px;
            border-bottom: 1px solid var(--border-color);
            font-size: 14px;
        }

        tr:last-child td {
            border-bottom: none;
        }

        tr:hover {
            background-color: rgba(0,0,0,0.02);
        }

        .dark-mode tr:hover {
            background-color: rgba(255,255,255,0.05);
        }

        .status-badge {
            padding: 4px 10px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: 500;
            display: inline-block;
        }

        .status-active {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
        }

        .status-inactive {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        .status-pending {
            background-color: rgba(245, 158, 11, 0.1);
            color: var(--warning-color);
        }

        .action-buttons {
            display: flex;
            gap: 8px;
        }

        .btn-edit {
            background-color: rgba(59, 130, 246, 0.1);
            color: var(--info-color);
        }

        .btn-delete {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
        }

        /* Modal Styles */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal-content {
            background-color: var(--card-bg);
            border-radius: 16px;
            width: 90%;
            max-width: 600px;
            max-height: 90vh;
            overflow-y: auto;
            box-shadow: 0 20px 40px rgba(0,0,0,0.2);
        }

        .modal-header {
            padding: 24px;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 20px;
            font-weight: 600;
        }

        .close-modal {
            background: none;
            border: none;
            font-size: 24px;
            color: var(--text-secondary);
            cursor: pointer;
            line-height: 1;
        }

        .modal-body {
            padding: 24px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: var(--text-primary);
        }

        .form-control {
            width: 100%;
            padding: 12px 16px;
            border-radius: 8px;
            border: 1px solid var(--border-color);
            background-color: var(--card-bg);
            color: var(--text-primary);
            font-size: 15px;
            transition: border-color 0.3s;
        }

        .form-control:focus {
            outline: none;
            border-color: var(--primary-color);
        }

        .form-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .modal-footer {
            padding: 20px 24px;
            border-top: 1px solid var(--border-color);
            display: flex;
            justify-content: flex-end;
            gap: 12px;
        }

        /* Login Form Styles */
        .login-container {
            display: flex;
            justify-content: center;
            align-items: center;
            min-height: 100vh;
            background-color: var(--light-bg);
            padding: 20px;
        }

        .login-card {
            background-color: var(--card-bg);
            border-radius: 16px;
            padding: 40px;
            width: 100%;
            max-width: 400px;
            box-shadow: 0 10px 30px rgba(0,0,0,0.1);
            border: 1px solid var(--border-color);
        }

        .login-logo {
            text-align: center;
            margin-bottom: 30px;
        }

        .login-logo-img {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            object-fit: contain;
            margin-bottom: 15px;
        }

        .login-title {
            font-size: 28px;
            font-weight: 700;
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 5px;
        }

        .login-subtitle {
            font-size: 14px;
            color: var(--text-secondary);
            text-align: center;
            margin-bottom: 30px;
        }

        .alert {
            padding: 12px 16px;
            border-radius: 8px;
            margin-bottom: 20px;
            font-size: 14px;
            display: none;
        }

        .alert-success {
            background-color: rgba(16, 185, 129, 0.1);
            color: var(--success-color);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .alert-error {
            background-color: rgba(239, 68, 68, 0.1);
            color: var(--danger-color);
            border: 1px solid rgba(239, 68, 68, 0.2);
        }

        /* Loading Spinner */
        .spinner {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .sidebar {
                width: 80px;
            }
            
            .main-content {
                margin-left: 80px;
            }
            
            .logo-text, .logo-subtitle, .nav-text, .admin-info {
                display: none;
            }
            
            .logo {
                justify-content: center;
            }
            
            .logo-img {
                width: 40px;
                height: 40px;
            }
            
            .nav-item {
                justify-content: center;
                padding: 16px;
            }
            
            .nav-icon {
                margin-right: 0;
                font-size: 20px;
            }
            
            .sidebar-footer {
                padding: 15px 10px;
            }
            
            .admin-profile {
                justify-content: center;
            }
        }

        @media (max-width: 768px) {
            .dashboard-cards {
                grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            }
            
            .form-row {
                grid-template-columns: 1fr;
            }
            
            .table-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 15px;
            }
            
            .table-actions {
                width: 100%;
                justify-content: flex-end;
            }
        }
    </style>
</head>
<body id="mainBody">
    <!-- Login Form (Initially visible) -->
    <div id="loginContainer" class="login-container">
        <div class="login-card">
            <div class="login-logo">
                <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" alt="THE SONGA Logo" class="login-logo-img">
                <h1 class="login-title">THE SONGA</h1>
                <p class="login-subtitle">Admin Panel Login</p>
            </div>
            
            <div id="loginAlert" class="alert" style="display: none;"></div>
            
            <form id="loginForm">
                <div class="form-group">
                    <label class="form-label">Email Address</label>
                    <input type="email" class="form-control" id="loginEmail" required placeholder="admin@thesongawelfare.com">
                </div>
                
                <div class="form-group">
                    <label class="form-label">Password</label>
                    <input type="password" class="form-control" id="loginPassword" required>
                </div>
                
                <button type="submit" class="btn btn-primary" style="width: 100%; padding: 14px;" id="loginBtn">
                    <span id="loginBtnText">Login to Admin Panel</span>
                    <span id="loginSpinner" class="spinner" style="display: none;"></span>
                </button>
            </form>
        </div>
    </div>

    <!-- Admin Panel (Initially hidden) -->
    <div id="adminPanel" class="admin-container" style="display: none;">
        <!-- Sidebar -->
        <div class="sidebar">
            <div class="logo-section">
                <div class="logo">
                    <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" alt="THE SONGA Logo" class="logo-img">
                    <div>
                        <div class="logo-text">SONGA</div>
                        <div class="logo-subtitle">ADMIN PANEL</div>
                    </div>
                </div>
            </div>
            
            <div class="nav-menu">
                <a href="#" class="nav-item active" data-section="dashboard">
                    <i class="fas fa-tachometer-alt nav-icon"></i>
                    <span class="nav-text">Dashboard</span>
                </a>
                <a href="#" class="nav-item" data-section="users">
                    <i class="fas fa-users nav-icon"></i>
                    <span class="nav-text">Users</span>
                </a>
                <a href="#" class="nav-item" data-section="posts">
                    <i class="fas fa-newspaper nav-icon"></i>
                    <span class="nav-text">Community Posts</span>
                </a>
                <a href="#" class="nav-item" data-section="library">
                    <i class="fas fa-book nav-icon"></i>
                    <span class="nav-text">Library</span>
                </a>
                <a href="#" class="nav-item" data-section="events">
                    <i class="fas fa-calendar-alt nav-icon"></i>
                    <span class="nav-text">Events</span>
                </a>
                <a href="#" class="nav-item" data-section="subscriptions">
                    <i class="fas fa-credit-card nav-icon"></i>
                    <span class="nav-text">Subscriptions</span>
                </a>
                <a href="#" class="nav-item" data-section="analytics">
                    <i class="fas fa-chart-bar nav-icon"></i>
                    <span class="nav-text">Analytics</span>
                </a>
                <a href="#" class="nav-item" data-section="settings">
                    <i class="fas fa-cog nav-icon"></i>
                    <span class="nav-text">Settings</span>
                </a>
            </div>
            
            <div class="sidebar-footer">
                <div class="admin-profile">
                    <img src="https://i.postimg.cc/BbdzCkxQ/20260116_0851_Elegant_Lion_Emblem_remix_01kf2npwbtf06ttr4htekjnd47_removebg_preview_2.webp" alt="Admin Avatar" class="admin-avatar" id="adminAvatar">
                    <div class="admin-info">
                        <h4 id="adminName">THE SONGA Admin</h4>
                        <p id="adminEmail"></p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Main Content -->
        <div class="main-content">
            <div class="top-bar">
                <h1 class="page-title">Admin Dashboard</h1>
                <div class="top-bar-actions">
                    <button class="mode-toggle" id="modeToggle">
                        <i class="fas fa-moon"></i>
                    </button>
                    <button class="notification-btn" id="notificationBtn">
                        <i class="fas fa-bell"></i>
                    </button>
                    <button class="btn btn-primary btn-sm" id="logoutBtn">
                        <i class="fas fa-sign-out-alt btn-icon"></i> Logout
                    </button>
                </div>
            </div>

            <!-- Dashboard Section -->
            <section id="dashboard-section" class="content-section">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Total Users</h3>
                            <div class="card-icon users-icon">
                                <i class="fas fa-users"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalUsers">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="usersChange">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Community Posts</h3>
                            <div class="card-icon posts-icon">
                                <i class="fas fa-newspaper"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalPosts">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="postsChange">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Library Books</h3>
                            <div class="card-icon books-icon">
                                <i class="fas fa-book"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalBooks">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span id="booksChange">Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Events</h3>
                            <div class="card-icon events-icon">
                                <i class="fas fa-calendar-alt"></i>
                            </div>
                        </div>
                        <div class="card-value" id="totalEvents">0</div>
                        <div class="card-change negative">
                            <i class="fas fa-arrow-down"></i> <span id="eventsChange">Loading...</span>
                        </div>
                    </div>
                </div>

                <!-- Recent Activity Table -->
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Recent Activity</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" id="exportBtn">
                                <i class="fas fa-download btn-icon"></i> Export
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>User</th>
                                <th>Action</th>
                                <th>Details</th>
                                <th>Time</th>
                                <th>Status</th>
                            </tr>
                        </thead>
                        <tbody id="activityTable">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading activity...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Users Section -->
            <section id="users-section" class="content-section" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Manage Users</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" id="refreshUsers">
                                <i class="fas fa-sync-alt btn-icon"></i> Refresh
                            </button>
                            <button class="btn btn-primary btn-sm" id="addUserBtn">
                                <i class="fas fa-plus btn-icon"></i> Add User
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Name</th>
                                <th>Email</th>
                                <th>Membership</th>
                                <th>Status</th>
                                <th>Joined</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="usersTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading users...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Posts Section -->
            <section id="posts-section" class="content-section" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Community Posts</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" id="filterPostsBtn">
                                <i class="fas fa-filter btn-icon"></i> Filter
                            </button>
                            <button class="btn btn-primary btn-sm" id="addPostBtn">
                                <i class="fas fa-plus btn-icon"></i> New Post
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Category</th>
                                <th>Likes</th>
                                <th>Comments</th>
                                <th>Date</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="postsTable">
                            <tr>
                                <td colspan="7" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading posts...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Library Section -->
            <section id="library-section" class="content-section" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Library Books</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" id="searchBooksBtn">
                                <i class="fas fa-search btn-icon"></i> Search
                            </button>
                            <button class="btn btn-primary btn-sm" id="addBookBtn">
                                <i class="fas fa-plus btn-icon"></i> Add Book
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Title</th>
                                <th>Author</th>
                                <th>Category</th>
                                <th>Availability</th>
                                <th>Rating</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="booksTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading books...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Events Section -->
            <section id="events-section" class="content-section" style="display: none;">
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">Events</h3>
                        <div class="table-actions">
                            <button class="btn btn-secondary btn-sm" id="viewCalendarBtn">
                                <i class="fas fa-calendar btn-icon"></i> View Calendar
                            </button>
                            <button class="btn btn-primary btn-sm" id="addEventBtn">
                                <i class="fas fa-plus btn-icon"></i> Create Event
                            </button>
                        </div>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Event Title</th>
                                <th>Date & Time</th>
                                <th>Location</th>
                                <th>Attendees</th>
                                <th>Status</th>
                                <th>Actions</th>
                            </tr>
                        </thead>
                        <tbody id="eventsTable">
                            <tr>
                                <td colspan="6" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading events...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <!-- Analytics Section -->
            <section id="analytics-section" class="content-section" style="display: none;">
                <div class="dashboard-cards">
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Active Users Today</h3>
                            <div class="card-icon users-icon">
                                <i class="fas fa-user-check"></i>
                            </div>
                        </div>
                        <div class="card-value" id="activeUsers">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Books Borrowed</h3>
                            <div class="card-icon books-icon">
                                <i class="fas fa-book-reader"></i>
                            </div>
                        </div>
                        <div class="card-value" id="booksBorrowed">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Page Views</h3>
                            <div class="card-icon posts-icon">
                                <i class="fas fa-eye"></i>
                            </div>
                        </div>
                        <div class="card-value" id="pageViews">0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span>Loading...</span>
                        </div>
                    </div>
                    
                    <div class="card">
                        <div class="card-header">
                            <h3 class="card-title">Revenue</h3>
                            <div class="card-icon events-icon">
                                <i class="fas fa-money-bill-wave"></i>
                            </div>
                        </div>
                        <div class="card-value" id="revenue">KSh 0</div>
                        <div class="card-change positive">
                            <i class="fas fa-arrow-up"></i> <span>Loading...</span>
                        </div>
                    </div>
                </div>
                
                <div class="table-container">
                    <div class="table-header">
                        <h3 class="table-title">System Logs</h3>
                    </div>
                    <table>
                        <thead>
                            <tr>
                                <th>Timestamp</th>
                                <th>Action</th>
                                <th>User</th>
                                <th>Details</th>
                                <th>IP Address</th>
                            </tr>
                        </thead>
                        <tbody id="logsTable">
                            <tr>
                                <td colspan="5" style="text-align: center; padding: 40px;">
                                    <div style="display: flex; flex-direction: column; align-items: center; gap: 10px;">
                                        <div class="spinner"></div>
                                        <div>Loading logs...</div>
                                    </div>
                                </td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>
        </div>
    </div>

    <!-- Modals (same as before, but now properly connected to Firebase) -->
    <div id="userModal" class="modal">
        <div class="modal-content">
            <div class="modal-header">
                <h3 class="modal-title">Add/Edit User</h3>
                <button class="close-modal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="userForm">
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">First Name</label>
                            <input type="text" class="form-control" id="firstName" required>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Last Name</label>
                            <input type="text" class="form-control" id="lastName" required>
                        </div>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Email</label>
                        <input type="email" class="form-control" id="email" required>
                    </div>
                    
                    <div class="form-group">
                        <label class="form-label">Phone Number</label>
                        <input type="text" class="form-control" id="phone" placeholder="254712345678">
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            <label class="form-label">Membership Tier</label>
                            <select class="form-control" id="membershipTier">
                                <option value="explorer">Explorer</option>
                                <option value="scholar">Scholar</option>
                                <option value="visionary">Visionary</option>
                                <option value="admin">Admin</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label class="form-label">Status</label>
                            <select class="form-control" id="userStatus">
                                <option value="active">Active</option>
                                <option value="inactive">Inactive</option>
                                <option value="suspended">Suspended</option>
                            </select>
                        </div>
                    </div>
                    
                    <input type="hidden" id="userId">
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary close-modal">Cancel</button>
                <button type="button" class="btn btn-primary" id="saveUserBtn">Save User</button>
            </div>
        </div>
    </div>

    <!-- Other modals (Post, Book, Event) would follow similar structure -->

    <script>
        // Your Firebase configuration from the provided SDK
        const firebaseConfig = {
            apiKey: "AIzaSyBDZicoo7dFLtSmgRPvQE_gdm-tNOyCTXA",
            authDomain: "the-songa-77b1b.firebaseapp.com",
            databaseURL: "https://the-songa-77b1b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "the-songa-77b1b",
            storageBucket: "the-songa-77b1b.firebasestorage.app",
            messagingSenderId: "123922889572",
            appId: "1:123922889572:web:482b2a624930baaf92d871"
        };

        // Initialize Firebase
        firebase.initializeApp(firebaseConfig);
        const auth = firebase.auth();
        const database = firebase.database();

        // Global variables
        let currentUser = null;
        let currentEditingId = null;

        // DOM Elements
        const loginContainer = document.getElementById('loginContainer');
        const adminPanel = document.getElementById('adminPanel');
        const loginForm = document.getElementById('loginForm');
        const loginBtn = document.getElementById('loginBtn');
        const loginBtnText = document.getElementById('loginBtnText');
        const loginSpinner = document.getElementById('loginSpinner');
        const loginAlert = document.getElementById('loginAlert');
        
        const navItems = document.querySelectorAll('.nav-item');
        const contentSections = document.querySelectorAll('.content-section');
        const logoutBtn = document.getElementById('logoutBtn');
        const modeToggle = document.getElementById('modeToggle');
        
        // Check if user is already logged in
        auth.onAuthStateChanged((user) => {
            if (user) {
                // User is signed in
                currentUser = user;
                showAdminPanel(user);
                loadAllData();
            } else {
                // No user is signed in
                showLoginForm();
            }
        });

        // Login form submission
        loginForm.addEventListener('submit', async (e) => {
            e.preventDefault();
            
            const email = document.getElementById('loginEmail').value;
            const password = document.getElementById('loginPassword').value;
            
            // Show loading state
            loginBtn.disabled = true;
            loginBtnText.textContent = 'Authenticating...';
            loginSpinner.style.display = 'inline-block';
            loginAlert.style.display = 'none';
            
            try {
                // Sign in with email/password
                const userCredential = await auth.signInWithEmailAndPassword(email, password);
                
                // Check if user is admin (you might want to check a custom claim or database field)
                // For now, we'll just allow any authenticated user
                
                // Show success message
                showAlert('Login successful! Redirecting...', 'success');
                
                // The onAuthStateChanged handler will take care of the rest
                
            } catch (error) {
                // Handle errors
                let errorMessage = 'Login failed. Please try again.';
                
                switch (error.code) {
                    case 'auth/user-not-found':
                        errorMessage = 'No user found with this email.';
                        break;
                    case 'auth/wrong-password':
                        errorMessage = 'Incorrect password.';
                        break;
                    case 'auth/invalid-email':
                        errorMessage = 'Invalid email address.';
                        break;
                    case 'auth/user-disabled':
                        errorMessage = 'This account has been disabled.';
                        break;
                }
                
                showAlert(errorMessage, 'error');
                
                // Reset button state
                loginBtn.disabled = false;
                loginBtnText.textContent = 'Login to Admin Panel';
                loginSpinner.style.display = 'none';
            }
        });

        // Logout
        logoutBtn.addEventListener('click', () => {
            if (confirm('Are you sure you want to logout?')) {
                auth.signOut().then(() => {
                    showLoginForm();
                }).catch((error) => {
                    console.error('Logout error:', error);
                });
            }
        });

        // Navigation
        navItems.forEach(item => {
            item.addEventListener('click', function(e) {
                e.preventDefault();
                
                // Update active nav item
                navItems.forEach(nav => nav.classList.remove('active'));
                this.classList.add('active');
                
                // Show selected section
                const sectionId = this.getAttribute('data-section');
                contentSections.forEach(section => {
                    section.style.display = 'none';
                });
                
                document.getElementById(`${sectionId}-section`).style.display = 'block';
                
                // Update page title
                const pageTitle = document.querySelector('.page-title');
                const sectionTitles = {
                    'dashboard': 'Admin Dashboard',
                    'users': 'User Management',
                    'posts': 'Community Posts',
                    'library': 'Library Management',
                    'events': 'Event Management',
                    'analytics': 'Analytics & Reports'
                };
                
                pageTitle.textContent = sectionTitles[sectionId] || 'Admin Panel';
            });
        });

        // Dark mode toggle
        modeToggle.addEventListener('click', function() {
            document.body.classList.toggle('dark-mode');
            const icon = this.querySelector('i');
            if (document.body.classList.contains('dark-mode')) {
                icon.classList.remove('fa-moon');
                icon.classList.add('fa-sun');
                localStorage.setItem('theme', 'dark');
            } else {
                icon.classList.remove('fa-sun');
                icon.classList.add('fa-moon');
                localStorage.setItem('theme', 'light');
            }
        });

        // Load saved theme
        const savedTheme = localStorage.getItem('theme');
        if (savedTheme === 'dark') {
            document.body.classList.add('dark-mode');
            modeToggle.querySelector('i').classList.remove('fa-moon');
            modeToggle.querySelector('i').classList.add('fa-sun');
        }

        // Firebase Data Loading Functions
        function loadAllData() {
            loadDashboardData();
            loadUsers();
            loadPosts();
            loadBooks();
            loadEvents();
            loadLogs();
        }

        function loadDashboardData() {
            // Load users count
            database.ref('users').once('value').then((snapshot) => {
                const users = snapshot.val();
                const userCount = users ? Object.keys(users).length : 0;
                document.getElementById('totalUsers').textContent = userCount;
            });

            // Load posts count
            database.ref('communityPosts').once('value').then((snapshot) => {
                const posts = snapshot.val();
                const postCount = posts ? Object.keys(posts).length : 0;
                document.getElementById('totalPosts').textContent = postCount;
            });

            // Load books count
            database.ref('libraryBooks').once('value').then((snapshot) => {
                const books = snapshot.val();
                const bookCount = books ? Object.keys(books).length : 0;
                document.getElementById('totalBooks').textContent = bookCount;
            });

            // Load events count
            database.ref('events').once('value').then((snapshot) => {
                const events = snapshot.val();
                const eventCount = events ? Object.keys(events).length : 0;
                document.getElementById('totalEvents').textContent = eventCount;
            });

            // Load analytics
            database.ref('analytics/totals').once('value').then((snapshot) => {
                const analytics = snapshot.val();
                if (analytics) {
                    document.getElementById('booksBorrowed').textContent = analytics.totalBorrows || 0;
                    
                    // Calculate revenue (simplified - you might have a better way)
                    const revenue = (analytics.totalUsers || 0) * 800; // Assuming average 800 KSh per user
                    document.getElementById('revenue').textContent = `KSh ${revenue.toLocaleString()}`;
                }
            });

            // Load today's stats
            const today = new Date().toISOString().split('T')[0];
            database.ref(`analytics/dailyStats/${today}`).once('value').then((snapshot) => {
                const dailyStats = snapshot.val();
                if (dailyStats) {
                    document.getElementById('activeUsers').textContent = dailyStats.activeUsers || 0;
                    document.getElementById('pageViews').textContent = dailyStats.pageViews || 0;
                }
            });
        }

        function loadUsers() {
            const usersTable = document.getElementById('usersTable');
            
            database.ref('users').on('value', (snapshot) => {
                const users = snapshot.val();
                usersTable.innerHTML = '';
                
                if (!users) {
                    usersTable.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                No users found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                Object.keys(users).forEach(userId => {
                    const user = users[userId];
                    const row = document.createElement('tr');
                    
                    // Format date
                    const joinedDate = user.joinedDate ? 
                        new Date(user.joinedDate).toLocaleDateString() : 'N/A';
                    
                    row.innerHTML = `
                        <td>
                            <div style="display: flex; align-items: center; gap: 10px;">
                                <img src="${user.profilePicture || 'https://via.placeholder.com/36'}" 
                                     alt="${user.firstName}" 
                                     style="width: 36px; height: 36px; border-radius: 50%; object-fit: cover;">
                                <div>
                                    <div style="font-weight: 500;">${user.firstName} ${user.lastName}</div>
                                    <div style="font-size: 12px; color: var(--text-secondary);">${userId}</div>
                                </div>
                            </div>
                        </td>
                        <td>${user.email}</td>
                        <td>
                            <span class="status-badge ${user.membershipTier === 'admin' ? 'status-active' : 'status-pending'}">
                                ${user.membershipTier || 'explorer'}
                            </span>
                        </td>
                        <td>
                            <span class="status-badge ${user.status === 'active' ? 'status-active' : 'status-inactive'}">
                                ${user.status || 'active'}
                            </span>
                        </td>
                        <td>${joinedDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-sm" onclick="editUser('${userId}')">
                                    <i class="fas fa-edit btn-icon"></i>
                                </button>
                                <button class="btn btn-delete btn-sm" onclick="deleteUser('${userId}')">
                                    <i class="fas fa-trash btn-icon"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    usersTable.appendChild(row);
                });
            });
        }

        function loadPosts() {
            const postsTable = document.getElementById('postsTable');
            
            database.ref('communityPosts').on('value', (snapshot) => {
                const posts = snapshot.val();
                postsTable.innerHTML = '';
                
                if (!posts) {
                    postsTable.innerHTML = `
                        <tr>
                            <td colspan="7" style="text-align: center; padding: 40px;">
                                No posts found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                Object.keys(posts).forEach(postId => {
                    const post = posts[postId];
                    const row = document.createElement('tr');
                    
                    // Format date
                    const postDate = post.createdAt ? 
                        new Date(post.createdAt).toLocaleDateString() : 'N/A';
                    
                    row.innerHTML = `
                        <td>
                            <div style="font-weight: 500;">${post.title || 'Untitled'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${postId}</div>
                        </td>
                        <td>${post.authorName || 'Unknown'}</td>
                        <td>
                            <span class="status-badge ${post.category === 'announcement' ? 'status-active' : 'status-pending'}">
                                ${post.category || 'general'}
                            </span>
                        </td>
                        <td>${post.likes || 0}</td>
                        <td>${post.comments || 0}</td>
                        <td>${postDate}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-sm" onclick="editPost('${postId}')">
                                    <i class="fas fa-edit btn-icon"></i>
                                </button>
                                <button class="btn btn-delete btn-sm" onclick="deletePost('${postId}')">
                                    <i class="fas fa-trash btn-icon"></i>
                                </button>
                                <button class="btn btn-secondary btn-sm" onclick="togglePinPost('${postId}', ${post.isPinned || false})">
                                    <i class="fas fa-thumbtack btn-icon ${post.isPinned ? 'text-primary' : ''}"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    postsTable.appendChild(row);
                });
            });
        }

        function loadBooks() {
            const booksTable = document.getElementById('booksTable');
            
            database.ref('libraryBooks').on('value', (snapshot) => {
                const books = snapshot.val();
                booksTable.innerHTML = '';
                
                if (!books) {
                    booksTable.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                No books found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                Object.keys(books).forEach(bookId => {
                    const book = books[bookId];
                    const row = document.createElement('tr');
                    
                    row.innerHTML = `
                        <td>
                            <div style="font-weight: 500;">${book.title || 'Untitled'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${bookId}</div>
                        </td>
                        <td>${book.author || 'Unknown'}</td>
                        <td>${book.category || 'Uncategorized'}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span class="status-badge ${book.availableCopies > 0 ? 'status-active' : 'status-inactive'}">
                                    ${book.availableCopies > 0 ? 'Available' : 'Out of Stock'}
                                </span>
                                <span style="font-size: 12px; color: var(--text-secondary);">
                                    (${book.availableCopies || 0}/${book.totalCopies || 0})
                                </span>
                            </div>
                        </td>
                        <td>${book.rating ? `${book.rating}/5.0` : 'N/A'}</td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-sm" onclick="editBook('${bookId}')">
                                    <i class="fas fa-edit btn-icon"></i>
                                </button>
                                <button class="btn btn-delete btn-sm" onclick="deleteBook('${bookId}')">
                                    <i class="fas fa-trash btn-icon"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    booksTable.appendChild(row);
                });
            });
        }

        function loadEvents() {
            const eventsTable = document.getElementById('eventsTable');
            
            database.ref('events').on('value', (snapshot) => {
                const events = snapshot.val();
                eventsTable.innerHTML = '';
                
                if (!events) {
                    eventsTable.innerHTML = `
                        <tr>
                            <td colspan="6" style="text-align: center; padding: 40px;">
                                No events found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                Object.keys(events).forEach(eventId => {
                    const event = events[eventId];
                    const row = document.createElement('tr');
                    
                    // Format date
                    const eventDate = event.date ? 
                        new Date(event.date).toLocaleString() : 'N/A';
                    
                    row.innerHTML = `
                        <td>
                            <div style="font-weight: 500;">${event.title || 'Untitled Event'}</div>
                            <div style="font-size: 12px; color: var(--text-secondary); margin-top: 4px;">${eventId}</div>
                        </td>
                        <td>${eventDate}</td>
                        <td>${event.location || 'Virtual'}</td>
                        <td>
                            <div style="display: flex; align-items: center; gap: 8px;">
                                <span>${event.currentAttendees || 0}/${event.maxAttendees || 0}</span>
                                <div style="width: 60px; height: 6px; background-color: rgba(0,0,0,0.1); border-radius: 3px;">
                                    <div style="width: ${((event.currentAttendees || 0)/(event.maxAttendees || 1))*100}%; height: 100%; background-color: var(--success-color); border-radius: 3px;"></div>
                                </div>
                            </div>
                        </td>
                        <td>
                            <span class="status-badge ${event.status === 'upcoming' ? 'status-active' : 'status-inactive'}">
                                ${event.status || 'upcoming'}
                            </span>
                        </td>
                        <td>
                            <div class="action-buttons">
                                <button class="btn btn-edit btn-sm" onclick="editEvent('${eventId}')">
                                    <i class="fas fa-edit btn-icon"></i>
                                </button>
                                <button class="btn btn-delete btn-sm" onclick="deleteEvent('${eventId}')">
                                    <i class="fas fa-trash btn-icon"></i>
                                </button>
                            </div>
                        </td>
                    `;
                    
                    eventsTable.appendChild(row);
                });
            });
        }

        function loadLogs() {
            const logsTable = document.getElementById('logsTable');
            
            database.ref('systemLogs').limitToLast(20).on('value', (snapshot) => {
                const logs = snapshot.val();
                logsTable.innerHTML = '';
                
                if (!logs) {
                    logsTable.innerHTML = `
                        <tr>
                            <td colspan="5" style="text-align: center; padding: 40px;">
                                No logs found.
                            </td>
                        </tr>
                    `;
                    return;
                }
                
                // Convert to array and reverse to show newest first
                const logsArray = Object.entries(logs).map(([id, log]) => ({ id, ...log }));
                logsArray.reverse();
                
                logsArray.forEach(log => {
                    const row = document.createElement('tr');
                    
                    // Format timestamp
                    const logTime = log.timestamp ? 
                        new Date(log.timestamp).toLocaleString() : 'N/A';
                    
                    row.innerHTML = `
                        <td>${logTime}</td>
                        <td>${log.action || 'Unknown'}</td>
                        <td>${log.userId || 'System'}</td>
                        <td>${log.details || 'No details'}</td>
                        <td>${log.ipAddress || 'N/A'}</td>
                    `;
                    
                    logsTable.appendChild(row);
                });
            });
        }

        // CRUD Operations
        window.editUser = function(userId) {
            database.ref(`users/${userId}`).once('value').then((snapshot) => {
                const user = snapshot.val();
                
                if (user) {
                    document.getElementById('firstName').value = user.firstName || '';
                    document.getElementById('lastName').value = user.lastName || '';
                    document.getElementById('email').value = user.email || '';
                    document.getElementById('phone').value = user.phoneNumber || '';
                    document.getElementById('membershipTier').value = user.membershipTier || 'explorer';
                    document.getElementById('userStatus').value = user.status || 'active';
                    document.getElementById('userId').value = userId;
                    
                    currentEditingId = userId;
                    
                    // Update modal title and button
                    document.querySelector('#userModal .modal-title').textContent = 'Edit User';
                    document.getElementById('saveUserBtn').textContent = 'Update User';
                    
                    // Show modal
                    document.getElementById('userModal').style.display = 'flex';
                }
            });
        };

        window.deleteUser = function(userId) {
            if (confirm(`Are you sure you want to delete user ${userId}?`)) {
                database.ref(`users/${userId}`).remove()
                    .then(() => {
                        showAlert('User deleted successfully!', 'success');
                    })
                    .catch((error) => {
                        showAlert('Error deleting user: ' + error.message, 'error');
                    });
            }
        };

        // Add User Button
        document.getElementById('addUserBtn').addEventListener('click', () => {
            // Reset form
            document.getElementById('userForm').reset();
            document.getElementById('userId').value = '';
            currentEditingId = null;
            
            // Update modal title and button
            document.querySelector('#userModal .modal-title').textContent = 'Add New User';
            document.getElementById('saveUserBtn').textContent = 'Save User';
            
            // Show modal
            document.getElementById('userModal').style.display = 'flex';
        });

        // Save User
        document.getElementById('saveUserBtn').addEventListener('click', () => {
            const userId = document.getElementById('userId').value;
            const userData = {
                firstName: document.getElementById('firstName').value,
                lastName: document.getElementById('lastName').value,
                email: document.getElementById('email').value,
                phoneNumber: document.getElementById('phone').value,
                membershipTier: document.getElementById('membershipTier').value,
                status: document.getElementById('userStatus').value,
                updatedAt: new Date().toISOString()
            };
            
            if (!userId) {
                // New user
                userData.joinedDate = new Date().toISOString();
                userData.lastLogin = new Date().toISOString();
                userData.membershipSince = new Date().toISOString();
                
                const newUserId = `user_${Date.now()}`;
                database.ref(`users/${newUserId}`).set(userData)
                    .then(() => {
                        showAlert('User added successfully!', 'success');
                        document.getElementById('userModal').style.display = 'none';
                    })
                    .catch((error) => {
                        showAlert('Error adding user: ' + error.message, 'error');
                    });
            } else {
                // Update existing user
                database.ref(`users/${userId}`).update(userData)
                    .then(() => {
                        showAlert('User updated successfully!', 'success');
                        document.getElementById('userModal').style.display = 'none';
                    })
                    .catch((error) => {
                        showAlert('Error updating user: ' + error.message, 'error');
                    });
            }
        });

        // Similar functions would be implemented for posts, books, and events
        // Due to length, I'll show the pattern for users above

        // Utility Functions
        function showLoginForm() {
            loginContainer.style.display = 'flex';
            adminPanel.style.display = 'none';
            loginForm.reset();
            
            // Reset button state
            loginBtn.disabled = false;
            loginBtnText.textContent = 'Login to Admin Panel';
            loginSpinner.style.display = 'none';
        }

        function showAdminPanel(user) {
            loginContainer.style.display = 'none';
            adminPanel.style.display = 'flex';
            
            // Update admin info
            document.getElementById('adminName').textContent = user.displayName || 'THE SONGA Admin';
            document.getElementById('adminEmail').textContent = user.email;
        }

        function showAlert(message, type) {
            const alert = document.getElementById('loginAlert');
            alert.textContent = message;
            alert.className = `alert alert-${type}`;
            alert.style.display = 'block';
            
            // Auto-hide after 5 seconds
            setTimeout(() => {
                alert.style.display = 'none';
            }, 5000);
        }

        // Add close modal functionality
        document.querySelectorAll('.close-modal').forEach(btn => {
            btn.addEventListener('click', function() {
                this.closest('.modal').style.display = 'none';
            });
        });

        // Close modal when clicking outside
        window.addEventListener('click', (e) => {
            if (e.target.classList.contains('modal')) {
                e.target.style.display = 'none';
            }
        });
    </script>
</body>
</html>

<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=yes">
    <title>THE SONGA â€¢ Inner Circle</title>
    <!-- Preconnect to critical domains -->
    <link rel="preconnect" href="https://cdnjs.cloudflare.com">
    <link rel="preconnect" href="https://www.gstatic.com">
    <link rel="preconnect" href="https://i.postimg.cc">
    <link rel="preconnect" href="https://accounts.google.com">

    <!-- PWA Manifest Connection -->
    <link rel="manifest" href="/manifest.json">
    <meta name="theme-color" content="#D4AF37">
    
    <!-- Icons for PWA -->
    <link rel="icon" href="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp">
    <link rel="apple-touch-icon" href="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp">
    
    <!-- Other meta tags -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="THE SONGA">
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- Google Fonts -->
    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@400;500;600;700;800&display=swap" rel="stylesheet">
    
    <style>
        /* RESET AND BASE STYLES */
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        :root {
            --gold: #D4AF37;
            --gold-light: #F5E6B3;
            --gold-dark: #B8860B;
            --black: #000000;
            --white: #ffffff;
            --gray-50: #f9f9f9;
            --gray-100: #f0f0f0;
            --gray-200: #e5e5e5;
            --gray-300: #d4d4d4;
            --gray-400: #a3a3a3;
            --gray-500: #737373;
            --gray-600: #525252;
            --gray-700: #404040;
            --gray-800: #262626;
            --gray-900: #171717;
            --accent: #25D366;
            --comment-bg: #f8f9fa;
            --reply-bg: #f0f2f5;
            --shadow: rgba(0, 0, 0, 0.1);
            --shadow-lg: rgba(0, 0, 0, 0.15);
            --modal-overlay: rgba(0, 0, 0, 0.85);
            --card-shadow: 0 2px 4px rgba(0, 0, 0, 0.05);
            --hover-shadow: 0 8px 24px rgba(0, 0, 0, 0.1);
            --background: #ffffff;
            --success: #2ecc71;
            --error: #e74c3c;
            --info: #3498db;
            --border-color: #eaeaea;
            --sidebar-width: 275px;
            --header-height: 56px;
            --bottom-nav-height: 60px;
        }

        html {
            scroll-behavior: smooth;
            font-size: 16px;
        }

        body {
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            background-color: var(--white);
            color: var(--gray-900);
            line-height: 1.5;
            overflow-x: hidden;
            -webkit-font-smoothing: antialiased;
            -moz-osx-font-smoothing: grayscale;
            min-height: 100vh;
        }

        body.modal-open {
            overflow: hidden;
            height: 100vh;
        }

        /* ====================
           LAYOUT - 3 COLUMN FOR DESKTOP
        ==================== */
        .app-wrapper {
            display: flex;
            min-height: 100vh;
            max-width: 1400px;
            margin: 0 auto;
            position: relative;
        }

        /* Left Sidebar - Navigation */
        .left-sidebar {
            width: var(--sidebar-width);
            position: sticky;
            top: 0;
            height: 100vh;
            padding: 1rem 1.5rem;
            border-right: 1px solid var(--border-color);
            display: flex;
            flex-direction: column;
            background-color: var(--white);
            z-index: 10;
        }

        .sidebar-logo {
            margin-bottom: 2rem;
            padding: 0.5rem 0;
        }

        .sidebar-logo img {
            height: 48px;
            width: 48px;
            border-radius: 12px;
            object-fit: cover;
        }

        .sidebar-logo-text {
            font-weight: 800;
            font-size: 1.5rem;
            color: var(--gold-dark);
            letter-spacing: -0.5px;
        }

        .nav-menu {
            flex: 1;
            display: flex;
            flex-direction: column;
            gap: 0.5rem;
        }

        .nav-menu-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.75rem 1rem;
            border-radius: 30px;
            color: var(--gray-800);
            font-weight: 600;
            font-size: 1.2rem;
            transition: all 0.2s ease;
            cursor: pointer;
            text-decoration: none;
        }

        .nav-menu-item i {
            font-size: 1.5rem;
            width: 2rem;
        }

        .nav-menu-item:hover {
            background-color: var(--gold-light);
            color: var(--gold-dark);
        }

        .nav-menu-item.active {
            background-color: var(--gold-light);
            color: var(--gold-dark);
            font-weight: 700;
        }

        .nav-menu-item.active i {
            color: var(--gold-dark);
        }

        .post-button-large {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            border: none;
            padding: 1rem;
            border-radius: 30px;
            font-weight: 700;
            font-size: 1.1rem;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 1rem;
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .post-button-large:hover {
            transform: scale(1.02);
            box-shadow: 0 8px 20px rgba(212, 175, 55, 0.4);
        }

        .sidebar-user {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem;
            border-radius: 40px;
            margin-top: auto;
            cursor: pointer;
            transition: background-color 0.2s;
            position: relative;
        }

        .sidebar-user:hover {
            background-color: var(--gray-100);
        }

        .sidebar-user-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--gold);
            flex-shrink: 0;
        }

        .sidebar-user-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .sidebar-user-info {
            flex: 1;
            min-width: 0;
        }

        .sidebar-user-name {
            font-weight: 700;
            color: var(--gray-900);
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }

        .sidebar-user-handle {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        /* Main Content - Feed */
        .main-content {
            flex: 1;
            max-width: 600px;
            border-right: 1px solid var(--border-color);
            min-height: 100vh;
            background-color: var(--white);
        }

        .feed-header {
            position: sticky;
            top: 0;
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            padding: 1rem 1.5rem;
            border-bottom: 1px solid var(--border-color);
            z-index: 5;
            display: flex;
            align-items: center;
            justify-content: space-between;
        }

        .feed-header h2 {
            font-size: 1.5rem;
            font-weight: 800;
            color: var(--gray-900);
        }

        .feed-header .inner-circle-badge {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 700;
            margin-left: 0.5rem;
        }

        .new-posts-indicator {
            background: var(--gold);
            color: var(--black);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 700;
            cursor: pointer;
            display: none;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        /* Compose Post Box */
        .compose-box {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            display: flex;
            gap: 1rem;
            background-color: var(--white);
        }

        .compose-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .compose-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .compose-input-area {
            flex: 1;
        }

        .compose-input {
            width: 100%;
            border: none;
            outline: none;
            font-size: 1.1rem;
            padding: 0.75rem 0;
            resize: none;
            font-family: inherit;
            min-height: 60px;
        }

        .compose-input::placeholder {
            color: var(--gray-400);
        }

        .compose-actions {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-top: 0.75rem;
            padding-top: 0.75rem;
            border-top: 1px solid var(--border-color);
        }

        .compose-media-tools {
            display: flex;
            gap: 1rem;
        }

        .compose-tool-btn {
            background: none;
            border: none;
            color: var(--gold-dark);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.5rem;
            border-radius: 50%;
            transition: background-color 0.2s;
            width: 40px;
            height: 40px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .compose-tool-btn:hover {
            background-color: var(--gold-light);
        }

        .compose-submit {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            border: none;
            padding: 0.6rem 1.5rem;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .compose-submit:hover:not(:disabled) {
            transform: scale(1.05);
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .compose-submit:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .compose-preview {
            margin-top: 0.75rem;
            display: none;
            position: relative;
        }

        .compose-preview img {
            width: 100%;
            max-height: 300px;
            object-fit: cover;
            border-radius: 16px;
        }

        .remove-preview {
            position: absolute;
            top: 10px;
            right: 10px;
            background: rgba(0, 0, 0, 0.7);
            color: white;
            border: none;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        /* Categories Filter */
        .categories-filter {
            display: flex;
            gap: 0.5rem;
            padding: 0.75rem 1.5rem;
            overflow-x: auto;
            border-bottom: 1px solid var(--border-color);
            scrollbar-width: none;
        }

        .categories-filter::-webkit-scrollbar {
            display: none;
        }

        .category-filter-btn {
            padding: 0.5rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            background: var(--white);
            color: var(--gray-600);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            transition: all 0.2s ease;
            white-space: nowrap;
        }

        .category-filter-btn:hover {
            background: var(--gray-100);
        }

        .category-filter-btn.active {
            background: var(--gold);
            color: var(--black);
            border-color: var(--gold);
        }

        /* Posts Feed */
        .posts-feed {
            padding-bottom: 1rem;
        }

        /* Post Card */
        .post-card {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
            transition: background-color 0.2s;
            cursor: pointer;
        }

        .post-card:hover {
            background-color: var(--gray-50);
        }

        .post-card.pinned {
            background: linear-gradient(135deg, #fefce8 0%, #fef3c7 100%);
        }

        .pinned-indicator {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            color: var(--gold-dark);
            font-size: 0.85rem;
            margin-bottom: 0.75rem;
            font-weight: 600;
        }

        .post-header {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 0.5rem;
            position: relative;
        }

        .post-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            border: 2px solid var(--gold-light);
            flex-shrink: 0;
        }

        .post-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .post-author-info {
            flex: 1;
        }

        .post-author-row {
            display: flex;
            align-items: center;
            flex-wrap: wrap;
            gap: 0.25rem 0.5rem;
            margin-bottom: 0.25rem;
        }

        .post-author {
            font-weight: 700;
            color: var(--gray-900);
        }

        .post-author-badge {
            background: var(--gold-light);
            color: var(--gold-dark);
            padding: 0.15rem 0.5rem;
            border-radius: 12px;
            font-size: 0.7rem;
            font-weight: 700;
        }

        .post-time {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .post-time i {
            margin-right: 0.25rem;
        }

        .post-content {
            margin-left: 60px;
            margin-bottom: 1rem;
        }

        .post-content h3 {
            font-size: 1.2rem;
            font-weight: 700;
            margin-bottom: 0.5rem;
            color: var(--gray-900);
        }

        .post-content p {
            color: var(--gray-700);
            white-space: pre-line;
            line-height: 1.6;
        }

        .post-media {
            margin: 1rem 0;
            border-radius: 16px;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .post-media img {
            width: 100%;
            max-height: 400px;
            object-fit: cover;
            display: block;
        }

        .post-tags {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            margin: 0.75rem 0;
        }

        .post-tag {
            color: var(--gold-dark);
            background: var(--gold-light);
            padding: 0.25rem 0.75rem;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .post-actions {
            display: flex;
            gap: 0.25rem;
            margin-left: 60px;
            margin-top: 0.75rem;
        }

        .post-action {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            padding: 0.5rem 1rem;
            border: none;
            background: none;
            color: var(--gray-500);
            font-weight: 600;
            font-size: 0.9rem;
            cursor: pointer;
            border-radius: 30px;
            transition: all 0.2s;
        }

        .post-action i {
            font-size: 1.1rem;
        }

        .post-action:hover {
            background-color: var(--gray-100);
            color: var(--gold-dark);
        }

        .post-action.liked {
            color: #e74c3c;
        }

        .post-action.liked i {
            font-weight: 900;
        }

        .post-action.saved {
            color: var(--gold-dark);
        }

        .post-options-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: none;
            border: none;
            color: var(--gray-400);
            padding: 0.5rem;
            border-radius: 50%;
            cursor: pointer;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .post-options-btn:hover {
            background-color: var(--gray-100);
            color: var(--gold-dark);
        }

        .post-options-dropdown {
            position: absolute;
            top: 40px;
            right: 0;
            background: var(--white);
            border-radius: 16px;
            box-shadow: 0 8px 30px var(--shadow-lg);
            min-width: 180px;
            z-index: 10;
            display: none;
            overflow: hidden;
            border: 1px solid var(--border-color);
        }

        .post-options-dropdown.active {
            display: block;
        }

        .post-option-item {
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            cursor: pointer;
            transition: background-color 0.2s;
            color: var(--gray-700);
        }

        .post-option-item:hover {
            background-color: var(--gold-light);
            color: var(--gold-dark);
        }

        .post-option-item.delete {
            color: var(--error);
        }

        .post-option-item.delete:hover {
            background-color: rgba(231, 76, 60, 0.1);
        }

        /* Comments Section */
        .comments-section {
            margin-top: 1rem;
            padding-top: 1rem;
            border-top: 1px solid var(--border-color);
            display: none;
        }

        .comments-section.active {
            display: block;
        }

        .comments-header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 1rem;
        }

        .comments-title {
            font-size: 1.1rem;
            font-weight: 700;
        }

        .close-comments {
            background: none;
            border: none;
            color: var(--gray-500);
            font-size: 1.2rem;
            cursor: pointer;
            padding: 0.25rem;
            border-radius: 50%;
            width: 32px;
            height: 32px;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .close-comments:hover {
            background-color: var(--gray-100);
        }

        .comments-list {
            max-height: 300px;
            overflow-y: auto;
            margin-bottom: 1rem;
        }

        .comment-item {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
            padding: 0.75rem;
            background: var(--gray-50);
            border-radius: 12px;
        }

        .comment-avatar {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .comment-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .comment-content {
            flex: 1;
        }

        .comment-header {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-bottom: 0.25rem;
            flex-wrap: wrap;
        }

        .comment-author {
            font-weight: 700;
            font-size: 0.9rem;
            color: var(--gray-900);
        }

        .comment-time {
            font-size: 0.75rem;
            color: var(--gray-500);
        }

        .comment-text {
            font-size: 0.9rem;
            color: var(--gray-700);
            line-height: 1.4;
        }

        .comment-form {
            display: flex;
            gap: 0.5rem;
            align-items: center;
            margin-top: 1rem;
        }

        .comment-input {
            flex: 1;
            padding: 0.75rem 1rem;
            border: 1px solid var(--border-color);
            border-radius: 30px;
            outline: none;
            font-size: 0.9rem;
        }

        .comment-input:focus {
            border-color: var(--gold);
        }

        .comment-submit {
            background: var(--gold);
            color: var(--black);
            border: none;
            width: 40px;
            height: 40px;
            border-radius: 50%;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.2s;
        }

        .comment-submit:hover {
            background: var(--gold-dark);
            transform: scale(1.05);
        }

        /* Right Sidebar - Trends & Suggestions */
        .right-sidebar {
            width: var(--sidebar-width);
            position: sticky;
            top: 0;
            height: 100vh;
            padding: 1rem 1.5rem;
            overflow-y: auto;
            display: block;
        }

        .search-box {
            background: var(--gray-100);
            border-radius: 30px;
            padding: 0.75rem 1rem;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            margin-bottom: 1.5rem;
        }

        .search-box i {
            color: var(--gray-400);
        }

        .search-box input {
            background: none;
            border: none;
            outline: none;
            width: 100%;
            font-size: 0.95rem;
        }

        .trends-card, .who-to-follow-card, .clubs-card {
            background: var(--gray-50);
            border-radius: 16px;
            padding: 1rem;
            margin-bottom: 1.5rem;
        }

        .card-title {
            font-weight: 800;
            font-size: 1.2rem;
            margin-bottom: 1rem;
        }

        .trend-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .trend-item:last-child {
            border-bottom: none;
        }

        .trend-category {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .trend-name {
            font-weight: 700;
            color: var(--gray-900);
        }

        .trend-posts {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .follow-item {
            display: flex;
            align-items: center;
            gap: 0.75rem;
            padding: 0.75rem 0;
            border-bottom: 1px solid var(--border-color);
        }

        .follow-item:last-child {
            border-bottom: none;
        }

        .follow-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            overflow: hidden;
            flex-shrink: 0;
        }

        .follow-avatar img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .follow-info {
            flex: 1;
        }

        .follow-name {
            font-weight: 700;
            color: var(--gray-900);
        }

        .follow-handle {
            font-size: 0.85rem;
            color: var(--gray-500);
        }

        .follow-btn {
            background: var(--black);
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-weight: 700;
            font-size: 0.85rem;
            cursor: pointer;
            transition: all 0.2s;
        }

        .follow-btn:hover {
            background: var(--gray-800);
        }

        .club-chip {
            display: inline-block;
            background: var(--white);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            margin: 0.25rem;
            font-weight: 600;
            font-size: 0.9rem;
            border: 1px solid var(--border-color);
        }

        /* Mobile Bottom Navigation */
        .mobile-bottom-nav {
            display: none;
            position: fixed;
            bottom: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-top: 1px solid var(--border-color);
            padding: 0.5rem 0;
            z-index: 100;
        }

        .mobile-nav-items {
            display: flex;
            justify-content: space-around;
            align-items: center;
        }

        .mobile-nav-item {
            display: flex;
            flex-direction: column;
            align-items: center;
            color: var(--gray-500);
            text-decoration: none;
            font-size: 0.7rem;
            padding: 0.5rem;
        }

        .mobile-nav-item i {
            font-size: 1.3rem;
            margin-bottom: 0.2rem;
        }

        .mobile-nav-item.active {
            color: var(--gold-dark);
        }

        .mobile-create-post {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            margin-top: -25px;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        /* Session Status */
        .session-status {
            position: fixed;
            top: 10px;
            right: 10px;
            background: var(--gold);
            color: var(--black);
            padding: 0.5rem 1rem;
            border-radius: 30px;
            font-size: 0.85rem;
            font-weight: 600;
            z-index: 1000;
            display: none;
            align-items: center;
            gap: 0.5rem;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
        }

        .session-status.visible {
            display: flex;
        }

        /* Back to Top */
        .back-to-top {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 44px;
            height: 44px;
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            color: var(--black);
            cursor: pointer;
            z-index: 99;
            box-shadow: 0 4px 12px rgba(212, 175, 55, 0.3);
            opacity: 0;
            transform: translateY(20px);
            transition: all 0.3s;
            border: none;
        }

        .back-to-top.visible {
            opacity: 1;
            transform: translateY(0);
        }

        /* Notification Toast */
        .notification-toast {
            position: fixed;
            top: 80px;
            right: 20px;
            background: var(--gray-900);
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            z-index: 1000;
            opacity: 0;
            transform: translateY(-20px);
            transition: all 0.3s;
            max-width: 300px;
            box-shadow: 0 8px 20px var(--shadow-lg);
            font-size: 0.9rem;
        }

        .notification-toast.show {
            opacity: 1;
            transform: translateY(0);
        }

        .notification-toast.success {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
        }

        .notification-toast.error {
            background: linear-gradient(135deg, #e74c3c, #c0392b);
        }

        /* Loading States */
        .loading-spinner {
            text-align: center;
            padding: 2rem;
        }

        .loading-spinner i {
            font-size: 2rem;
            color: var(--gold);
            animation: spin 1s linear infinite;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .skeleton-post {
            padding: 1.5rem;
            border-bottom: 1px solid var(--border-color);
        }

        .skeleton-header {
            display: flex;
            gap: 0.75rem;
            margin-bottom: 1rem;
        }

        .skeleton-avatar {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
        }

        .skeleton-line {
            height: 16px;
            background: linear-gradient(90deg, #f0f0f0 25%, #e0e0e0 50%, #f0f0f0 75%);
            background-size: 200% 100%;
            animation: loading 1.5s infinite;
            border-radius: 8px;
            margin-bottom: 0.5rem;
        }

        @keyframes loading {
            0% { background-position: 200% 0; }
            100% { background-position: -200% 0; }
        }

        /* Modals */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: var(--modal-overlay);
            z-index: 2000;
            justify-content: center;
            align-items: center;
            padding: 1rem;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: var(--white);
            border-radius: 24px;
            width: 100%;
            max-width: 500px;
            max-height: 85vh;
            overflow: hidden;
            display: flex;
            flex-direction: column;
            animation: slideUp 0.3s ease;
        }

        @keyframes slideUp {
            from {
                transform: translateY(50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            padding: 1.5rem;
            text-align: center;
            position: relative;
        }

        .modal-header h2 {
            font-size: 1.5rem;
            font-weight: 800;
        }

        .close-modal {
            position: absolute;
            top: 1rem;
            right: 1rem;
            background: rgba(0, 0, 0, 0.15);
            border: none;
            color: var(--black);
            width: 36px;
            height: 36px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            font-size: 1.4rem;
            transition: all 0.2s;
        }

        .close-modal:hover {
            background: rgba(0, 0, 0, 0.25);
            transform: rotate(90deg);
        }

        .modal-body {
            padding: 1.5rem;
            overflow-y: auto;
        }

        /* Sign In Modal */
        .onboarding-steps {
            display: flex;
            justify-content: center;
            gap: 0.5rem;
            margin: 1rem 0;
        }

        .step-indicator {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            background: var(--gray-300);
            transition: all 0.3s;
        }

        .step-indicator.active {
            width: 24px;
            border-radius: 12px;
            background: var(--gold);
        }

        .onboarding-slide {
            display: none;
        }

        .onboarding-slide.active {
            display: block;
        }

        .club-selection {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 1rem;
            margin: 1.5rem 0;
        }

        .club-card {
            background: white;
            border: 2px solid var(--border-color);
            border-radius: 16px;
            padding: 1.25rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.2s;
        }

        .club-card:hover {
            border-color: var(--gold);
            transform: translateY(-2px);
            box-shadow: var(--hover-shadow);
        }

        .club-card.selected {
            border-color: var(--gold);
            background: linear-gradient(135deg, rgba(212, 175, 55, 0.05), rgba(212, 175, 55, 0.1));
        }

        .club-icon {
            width: 48px;
            height: 48px;
            border-radius: 14px;
            background: linear-gradient(135deg, var(--gold-light), var(--gold));
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.3rem;
            color: var(--black);
            margin: 0 auto 0.75rem;
        }

        .club-info h4 {
            font-size: 1rem;
            font-weight: 700;
            margin-bottom: 0.25rem;
        }

        .club-info p {
            font-size: 0.8rem;
            color: var(--gray-500);
        }

        .btn-primary {
            background: linear-gradient(135deg, var(--gold), var(--gold-dark));
            color: var(--black);
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
            width: 100%;
            font-size: 1rem;
        }

        .btn-primary:hover:not(:disabled) {
            transform: translateY(-1px);
            box-shadow: 0 6px 15px rgba(212, 175, 55, 0.3);
        }

        .btn-primary:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .btn-outline {
            background: transparent;
            color: var(--gray-600);
            border: 2px solid var(--border-color);
            padding: 0.75rem 1.5rem;
            border-radius: 30px;
            font-weight: 700;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-outline:hover {
            border-color: var(--gold);
            color: var(--gold-dark);
        }

        /* Responsive Design */
        @media (max-width: 1200px) {
            .left-sidebar {
                width: 88px;
                padding: 1rem 0.5rem;
            }
            
            .sidebar-logo-text,
            .nav-menu-item span:not(.nav-icon),
            .sidebar-user-info,
            .post-button-large span {
                display: none;
            }
            
            .nav-menu-item {
                justify-content: center;
                padding: 0.75rem;
            }
            
            .nav-menu-item i {
                margin: 0;
                font-size: 1.8rem;
            }
            
            .post-button-large {
                padding: 0.75rem;
                justify-content: center;
            }
            
            .post-button-large i {
                font-size: 1.5rem;
                margin: 0;
            }
            
            .sidebar-user {
                justify-content: center;
            }
        }

        @media (max-width: 992px) {
            .right-sidebar {
                display: none;
            }
            
            .main-content {
                max-width: 100%;
            }
        }

        @media (max-width: 768px) {
            .app-wrapper {
                padding-bottom: var(--bottom-nav-height);
            }
            
            .left-sidebar {
                display: none;
            }
            
            .right-sidebar {
                display: none;
            }
            
            .mobile-bottom-nav {
                display: block;
            }
            
            .main-content {
                border-right: none;
            }
            
            .feed-header {
                padding: 0.75rem 1rem;
            }
            
            .feed-header h2 {
                font-size: 1.2rem;
            }
            
            .post-content {
                margin-left: 0;
            }
            
            .post-actions {
                margin-left: 0;
                justify-content: space-around;
            }
            
            .post-action {
                padding: 0.5rem;
            }
            
            .post-action span {
                display: none;
            }
            
            .compose-box {
                padding: 1rem;
            }
            
            .back-to-top {
                bottom: 70px;
                right: 16px;
            }
        }

        @media (min-width: 769px) {
            .mobile-bottom-nav {
                display: none;
            }
        }
    </style>
</head>
<body>
    <!-- Session Status -->
    <div class="session-status" id="sessionStatus">
        <i class="fas fa-check-circle"></i>
        <span>Session restored</span>
    </div>

    <!-- Back to Top -->
    <button class="back-to-top" id="backToTop">
        <i class="fas fa-arrow-up"></i>
    </button>

    <!-- Notification Toast -->
    <div class="notification-toast" id="notificationToast"></div>

    <!-- App Wrapper - 3 Column Layout -->
    <div class="app-wrapper">
        <!-- Left Sidebar - Navigation -->
        <aside class="left-sidebar">
            <div class="sidebar-logo">
                <img src="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp" alt="THE SONGA">
                <div class="sidebar-logo-text">SONGA</div>
            </div>

            <nav class="nav-menu">
                <a href="#" class="nav-menu-item active" id="navFeed">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="nav-menu-item" id="navExplore">
                    <i class="fas fa-hashtag"></i>
                    <span>Explore</span>
                </a>
                <a href="#" class="nav-menu-item" id="navNotifications">
                    <i class="fas fa-bell"></i>
                    <span>Notifications</span>
                    <span class="notification-badge hidden" id="sidebarNotificationBadge"></span>
                </a>
                <a href="#" class="nav-menu-item" id="navMessages">
                    <i class="fas fa-envelope"></i>
                    <span>Messages</span>
                </a>
                <a href="#" class="nav-menu-item" id="navLibrary">
                    <i class="fas fa-book"></i>
                    <span>Library</span>
                </a>
                <a href="#" class="nav-menu-item" id="navEvents">
                    <i class="fas fa-calendar-alt"></i>
                    <span>Events</span>
                </a>
                <a href="#" class="nav-menu-item" id="navProfile">
                    <i class="fas fa-user"></i>
                    <span>Profile</span>
                </a>
                <a href="#" class="nav-menu-item" id="navClubs">
                    <i class="fas fa-users"></i>
                    <span>My Clubs</span>
                </a>

                <button class="post-button-large" id="sidebarCreatePost">
                    <i class="fas fa-feather-alt"></i>
                    <span>Post</span>
                </button>
            </nav>

            <div class="sidebar-user" id="sidebarUser">
                <div class="sidebar-user-avatar">
                    <img id="sidebarUserAvatar" src="" alt="">
                </div>
                <div class="sidebar-user-info">
                    <div class="sidebar-user-name" id="sidebarUserName">Sign In</div>
                    <div class="sidebar-user-handle" id="sidebarUserHandle">@username</div>
                </div>
                <i class="fas fa-ellipsis-h"></i>
            </div>

            <!-- User Dropdown -->
            <div class="post-options-dropdown" id="userDropdown" style="position: fixed; bottom: 80px; left: 20px; min-width: 200px;">
                <div class="post-option-item" id="myProfileOption">
                    <i class="fas fa-user-circle"></i>
                    <span>My Profile</span>
                </div>
                <div class="post-option-item" id="myClubsOption">
                    <i class="fas fa-users"></i>
                    <span>My Clubs</span>
                </div>
                <div class="post-option-item" id="settingsOption">
                    <i class="fas fa-cog"></i>
                    <span>Settings</span>
                </div>
                <div class="post-option-item" id="signOutOption">
                    <i class="fas fa-sign-out-alt"></i>
                    <span>Sign Out</span>
                </div>
            </div>
        </aside>

        <!-- Main Content - Feed -->
        <main class="main-content">
            <div class="feed-header">
                <h2>
                    Home
                    <span class="inner-circle-badge">Inner Circle</span>
                </h2>
                <div class="new-posts-indicator" id="newPostsIndicator">
                    <i class="fas fa-sync-alt"></i>
                    <span>New posts</span>
                </div>
            </div>

            <!-- Compose Post Box -->
            <div class="compose-box" id="composeBox">
                <div class="compose-avatar">
                    <img id="composeAvatar" src="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp" alt="">
                </div>
                <div class="compose-input-area">
                    <textarea 
                        class="compose-input" 
                        id="composeInput" 
                        placeholder="What's happening in the Inner Circle?"
                        rows="1"
                    ></textarea>
                    
                    <div class="compose-preview" id="composePreview">
                        <img id="previewImage" src="" alt="Preview">
                        <button class="remove-preview" id="removePreviewBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>

                    <div class="compose-actions">
                        <div class="compose-media-tools">
                            <label for="composeImageUpload" class="compose-tool-btn">
                                <i class="fas fa-image"></i>
                            </label>
                            <input type="file" id="composeImageUpload" accept="image/*" style="display: none;">
                            <button class="compose-tool-btn" id="composeGifBtn">
                                <i class="fas fa-gift"></i>
                            </button>
                            <button class="compose-tool-btn" id="composePollBtn">
                                <i class="fas fa-poll"></i>
                            </button>
                        </div>
                        <button class="compose-submit" id="composeSubmit" disabled>
                            Post
                        </button>
                    </div>
                </div>
            </div>

            <!-- Categories Filter -->
            <div class="categories-filter">
                <button class="category-filter-btn active" data-category="all">For You</button>
                <button class="category-filter-btn" data-category="announcement">ðŸ“¢ Announcements</button>
                <button class="category-filter-btn" data-category="event">ðŸ“… Events</button>
                <button class="category-filter-btn" data-category="discussion">ðŸ’¬ Discussions</button>
                <button class="category-filter-btn" data-category="resource">ðŸ“š Resources</button>
            </div>

            <!-- Posts Feed -->
            <div class="posts-feed" id="postsFeed">
                <!-- Posts will be loaded here -->
                <div class="loading-spinner">
                    <i class="fas fa-spinner"></i>
                    <p>Loading posts...</p>
                </div>
            </div>
        </main>

        <!-- Right Sidebar - Trends & Suggestions -->
        <aside class="right-sidebar">
            <div class="search-box">
                <i class="fas fa-search"></i>
                <input type="text" placeholder="Search Inner Circle">
            </div>

            <div class="trends-card">
                <h3 class="card-title">Trends for you</h3>
                <div class="trend-item">
                    <div>
                        <div class="trend-category">Trending in Inner Circle</div>
                        <div class="trend-name">#Purpose</div>
                        <div class="trend-posts">245 posts</div>
                    </div>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
                <div class="trend-item">
                    <div>
                        <div class="trend-category">Trending in Logos</div>
                        <div class="trend-name">#ReadingChallenge</div>
                        <div class="trend-posts">89 posts</div>
                    </div>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
                <div class="trend-item">
                    <div>
                        <div class="trend-category">Trending in WorkFit</div>
                        <div class="trend-name">#WellnessWednesday</div>
                        <div class="trend-posts">156 posts</div>
                    </div>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
                <div class="trend-item">
                    <div>
                        <div class="trend-category">Trending in Talantae</div>
                        <div class="trend-name">#TalentShowcase</div>
                        <div class="trend-posts">67 posts</div>
                    </div>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
                <div class="trend-item">
                    <div>
                        <div class="trend-category">Trending in Stratum</div>
                        <div class="trend-name">#BusinessTips</div>
                        <div class="trend-posts">112 posts</div>
                    </div>
                    <i class="fas fa-ellipsis-h"></i>
                </div>
            </div>

            <div class="who-to-follow-card">
                <h3 class="card-title">Who to follow</h3>
                <div class="follow-item">
                    <div class="follow-avatar">
                        <img src="https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp" alt="">
                    </div>
                    <div class="follow-info">
                        <div class="follow-name">THE SONGA</div>
                        <div class="follow-handle">@thesonga</div>
                    </div>
                    <button class="follow-btn">Follow</button>
                </div>
                <div class="follow-item">
                    <div class="follow-avatar">
                        <img src="https://randomuser.me/api/portraits/men/32.jpg" alt="">
                    </div>
                    <div class="follow-info">
                        <div class="follow-name">Mugera Moses</div>
                        <div class="follow-handle">@mugera</div>
                    </div>
                    <button class="follow-btn">Follow</button>
                </div>
                <div class="follow-item">
                    <div class="follow-avatar">
                        <img src="https://randomuser.me/api/portraits/women/44.jpg" alt="">
                    </div>
                    <div class="follow-info">
                        <div class="follow-name">Sarah Johnson</div>
                        <div class="follow-handle">@sarahj</div>
                    </div>
                    <button class="follow-btn">Follow</button>
                </div>
                <div style="margin-top: 1rem; text-align: center;">
                    <a href="#" style="color: var(--gold-dark); text-decoration: none; font-weight: 600;">Show more</a>
                </div>
            </div>

            <div class="clubs-card">
                <h3 class="card-title">Your Clubs</h3>
                <div>
                    <span class="club-chip"><i class="fas fa-book-open"></i> Logos</span>
                    <span class="club-chip"><i class="fas fa-dumbbell"></i> WorkFit</span>
                    <span class="club-chip"><i class="fas fa-star"></i> Talantae</span>
                    <span class="club-chip"><i class="fas fa-briefcase"></i> Stratum</span>
                </div>
                <div style="margin-top: 1rem; text-align: center;">
                    <a href="#" style="color: var(--gold-dark); text-decoration: none; font-weight: 600;">Manage clubs</a>
                </div>
            </div>

            <div style="font-size: 0.8rem; color: var(--gray-500); padding: 1rem 0;">
                Â© 2026 THE SONGA Inner Circle<br>
                <span style="display: flex; gap: 1rem; margin-top: 0.5rem; flex-wrap: wrap;">
                    <a href="#" style="color: inherit; text-decoration: none;">Terms</a>
                    <a href="#" style="color: inherit; text-decoration: none;">Privacy</a>
                    <a href="#" style="color: inherit; text-decoration: none;">Cookies</a>
                    <a href="#" style="color: inherit; text-decoration: none;">Help</a>
                </span>
            </div>
        </aside>

        <!-- Mobile Bottom Navigation -->
        <nav class="mobile-bottom-nav">
            <div class="mobile-nav-items">
                <a href="#" class="mobile-nav-item active">
                    <i class="fas fa-home"></i>
                    <span>Home</span>
                </a>
                <a href="#" class="mobile-nav-item">
                    <i class="fas fa-search"></i>
                    <span>Explore</span>
                </a>
                <a href="#" class="mobile-nav-item" id="mobileCreatePost">
                    <div class="mobile-create-post">
                        <i class="fas fa-plus"></i>
                    </div>
                </a>
                <a href="#" class="mobile-nav-item">
                    <i class="fas fa-bell"></i>
                    <span>Alerts</span>
                </a>
                <a href="#" class="mobile-nav-item">
                    <i class="fas fa-user"></i>
                    <span>Me</span>
                </a>
            </div>
        </nav>
    </div>

    <!-- Sign In Modal -->
    <div class="modal" id="signinModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Join the Inner Circle</h2>
                <p>UNBOUND | UNBENT | UNBROKEN</p>
                <button class="close-modal" id="closeSigninModal">&times;</button>
            </div>
            <div class="modal-body">
                <!-- Step 1: Welcome -->
                <div class="onboarding-slide active" id="step1">
                    <h3 style="margin-bottom: 1rem;">Welcome to THE SONGA</h3>
                    <p>Experience exclusive access to our members-only platform where ambition meets opportunity.</p>
                    
                    <div style="background: var(--gray-50); padding: 1.5rem; border-radius: 16px; margin: 1.5rem 0;">
                        <h4 style="margin-bottom: 1rem; color: var(--gold-dark);">Inner Circle Benefits:</h4>
                        <ul style="list-style: none;">
                            <li style="margin-bottom: 0.75rem;">ðŸ“… Priority event updates</li>
                            <li style="margin-bottom: 0.75rem;">ðŸ“š Curated learning programs</li>
                            <li style="margin-bottom: 0.75rem;">ðŸŒŸ Talent development</li>
                            <li style="margin-bottom: 0.75rem;">ðŸ¤ Exclusive networking</li>
                            <li>ðŸ’¼ Professional workshops</li>
                        </ul>
                    </div>
                    
                    <button class="btn-primary" id="startOnboardingBtn">
                        Get Started <i class="fas fa-arrow-right"></i>
                    </button>
                </div>
                
                <!-- Step 2: Club Selection -->
                <div class="onboarding-slide" id="step2">
                    <h3 style="margin-bottom: 1rem;">Choose Your Clubs</h3>
                    <p>Select the clubs that match your interests:</p>
                    
                    <div class="club-selection">
                        <div class="club-card" data-club="logos">
                            <div class="club-icon">
                                <i class="fas fa-book-open"></i>
                            </div>
                            <div class="club-info">
                                <h4>Logos</h4>
                                <p>Reading Club</p>
                            </div>
                        </div>
                        
                        <div class="club-card" data-club="workfit">
                            <div class="club-icon">
                                <i class="fas fa-dumbbell"></i>
                            </div>
                            <div class="club-info">
                                <h4>WorkFit</h4>
                                <p>Fitness Club</p>
                            </div>
                        </div>
                        
                        <div class="club-card" data-club="talantae">
                            <div class="club-icon">
                                <i class="fas fa-star"></i>
                            </div>
                            <div class="club-info">
                                <h4>Talantae</h4>
                                <p>Talent Club</p>
                            </div>
                        </div>
                        
                        <div class="club-card" data-club="stratum">
                            <div class="club-icon">
                                <i class="fas fa-briefcase"></i>
                            </div>
                            <div class="club-info">
                                <h4>Stratum</h4>
                                <p>Business Club</p>
                            </div>
                        </div>
                    </div>
                    
                    <div style="display: flex; gap: 1rem; margin-top: 1.5rem;">
                        <button class="btn-outline" id="backToStep1Btn" style="flex: 1;">
                            <i class="fas fa-arrow-left"></i> Back
                        </button>
                        <button class="btn-primary" id="continueToStep3Btn" style="flex: 1;" disabled>
                            Continue
                        </button>
                    </div>
                </div>
                
                <!-- Step 3: Google Sign-in -->
                <div class="onboarding-slide" id="step3">
                    <h3 style="margin-bottom: 1rem;">Complete Your Membership</h3>
                    <p>Sign in with Google to access exclusive benefits.</p>
                    
                    <div id="selectedClubs" style="margin: 1.5rem 0; padding: 1rem; background: var(--gray-50); border-radius: 12px;">
                        <h4 style="margin-bottom: 0.75rem;">Your Selected Clubs:</h4>
                        <div id="selectedClubsList" style="display: flex; flex-wrap: wrap; gap: 0.5rem;"></div>
                    </div>
                    
                    <div class="google-signin-container" style="margin: 2rem 0; text-align: center;">
                        <div id="g_id_onload"
                             data-client_id="123922889572-9dmjivsoese0b0o78poo5mgu7nqqm6e6.apps.googleusercontent.com"
                             data-context="signin"
                             data-ux_mode="popup"
                             data-callback="handleGoogleSignIn"
                             data-auto_prompt="false">
                        </div>
                        <div class="g_id_signin"
                             data-type="standard"
                             data-shape="rectangular"
                             data-theme="outline"
                             data-text="signin_with"
                             data-size="large"
                             data-logo_alignment="left">
                        </div>
                    </div>
                    
                    <button class="btn-outline" id="backToStep2Btn" style="width: 100%;">
                        <i class="fas fa-arrow-left"></i> Back
                    </button>
                </div>
                
                <!-- Progress Indicators -->
                <div class="onboarding-steps">
                    <div class="step-indicator active" data-step="1"></div>
                    <div class="step-indicator" data-step="2"></div>
                    <div class="step-indicator" data-step="3"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Create Post Modal (for mobile) -->
    <div class="modal" id="createPostModal">
        <div class="modal-content">
            <div class="modal-header">
                <h2>Create Post</h2>
                <button class="close-modal" id="closeCreatePostModal">&times;</button>
            </div>
            <div class="modal-body">
                <form id="createPostForm">
                    <div style="margin-bottom: 1rem;">
                        <textarea id="modalPostContent" class="compose-input" placeholder="What's happening?" rows="4" style="width: 100%; padding: 1rem; border: 1px solid var(--border-color); border-radius: 12px;"></textarea>
                    </div>
                    
                    <div style="margin-bottom: 1rem;">
                        <label for="modalPostImage" style="display: flex; align-items: center; gap: 0.5rem; cursor: pointer; color: var(--gold-dark);">
                            <i class="fas fa-image"></i>
                            <span>Add Image</span>
                        </label>
                        <input type="file" id="modalPostImage" accept="image/*" style="display: none;">
                    </div>
                    
                    <div class="modal-preview" id="modalPreview" style="display: none; margin-bottom: 1rem; position: relative;">
                        <img id="modalPreviewImage" src="" style="width: 100%; border-radius: 12px;">
                        <button type="button" class="remove-preview" id="removeModalPreviewBtn">
                            <i class="fas fa-times"></i>
                        </button>
                    </div>
                    
                    <div style="display: flex; gap: 1rem;">
                        <button type="button" class="btn-outline" id="cancelModalPost" style="flex: 1;">Cancel</button>
                        <button type="submit" class="btn-primary" id="submitModalPost" style="flex: 1;">Post</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <!-- Firebase and Google Sign-In SDKs -->
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-database-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-auth-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.22.2/firebase-storage-compat.js"></script>
    <script src="https://accounts.google.com/gsi/client" async defer></script>

    <script>
        // ====================
        // FIREBASE CONFIGURATION
        // ====================
        const firebaseConfig = {
            apiKey: "AIzaSyBDZicoo7dFLtSmgRPvQE_gdm-tNOyCTXA",
            authDomain: "the-songa-77b1b.firebaseapp.com",
            databaseURL: "https://the-songa-77b1b-default-rtdb.europe-west1.firebasedatabase.app",
            projectId: "the-songa-77b1b",
            storageBucket: "the-songa-77b1b.firebasestorage.app",
            messagingSenderId: "123922889572",
            appId: "1:123922889572:web:482b2a624930baaf92d871"
        };

        // Initialize Firebase
        let firebaseApp;
        let database;
        let auth;
        let storage;

        try {
            if (!firebase.apps.length) {
                firebaseApp = firebase.initializeApp(firebaseConfig);
                console.log("Firebase initialized");
            } else {
                firebaseApp = firebase.app();
                console.log("Using existing Firebase instance");
            }
            
            database = firebase.database();
            auth = firebase.auth();
            storage = firebase.storage();
        } catch (error) {
            console.error("Firebase init error:", error);
        }

        // ====================
        // GLOBAL VARIABLES
        // ====================
        let currentUser = null;
        let currentUserData = null;
        let posts = [];
        let selectedClubs = [];
        let currentStep = 1;
        let currentFilter = 'all';
        let postToDelete = null;
        let currentImageFile = null;
        let realtimeListeners = [];

        // DOM Elements
        const elements = {
            // Session
            sessionStatus: document.getElementById('sessionStatus'),
            
            // Back to top
            backToTop: document.getElementById('backToTop'),
            
            // Toast
            notificationToast: document.getElementById('notificationToast'),
            
            // Sidebar
            sidebarUser: document.getElementById('sidebarUser'),
            sidebarUserAvatar: document.getElementById('sidebarUserAvatar'),
            sidebarUserName: document.getElementById('sidebarUserName'),
            sidebarUserHandle: document.getElementById('sidebarUserHandle'),
            userDropdown: document.getElementById('userDropdown'),
            signOutOption: document.getElementById('signOutOption'),
            myProfileOption: document.getElementById('myProfileOption'),
            myClubsOption: document.getElementById('myClubsOption'),
            sidebarCreatePost: document.getElementById('sidebarCreatePost'),
            
            // Compose
            composeBox: document.getElementById('composeBox'),
            composeAvatar: document.getElementById('composeAvatar'),
            composeInput: document.getElementById('composeInput'),
            composeSubmit: document.getElementById('composeSubmit'),
            composeImageUpload: document.getElementById('composeImageUpload'),
            composePreview: document.getElementById('composePreview'),
            previewImage: document.getElementById('previewImage'),
            removePreviewBtn: document.getElementById('removePreviewBtn'),
            
            // Feed
            postsFeed: document.getElementById('postsFeed'),
            newPostsIndicator: document.getElementById('newPostsIndicator'),
            
            // Filter buttons
            categoryFilters: document.querySelectorAll('.category-filter-btn'),
            
            // Mobile
            mobileCreatePost: document.getElementById('mobileCreatePost'),
            
            // Modals
            signinModal: document.getElementById('signinModal'),
            closeSigninModal: document.getElementById('closeSigninModal'),
            createPostModal: document.getElementById('createPostModal'),
            closeCreatePostModal: document.getElementById('closeCreatePostModal'),
            
            // Onboarding
            startOnboardingBtn: document.getElementById('startOnboardingBtn'),
            backToStep1Btn: document.getElementById('backToStep1Btn'),
            continueToStep3Btn: document.getElementById('continueToStep3Btn'),
            backToStep2Btn: document.getElementById('backToStep2Btn'),
            selectedClubsList: document.getElementById('selectedClubsList'),
            
            // Modal form
            createPostForm: document.getElementById('createPostForm'),
            modalPostContent: document.getElementById('modalPostContent'),
            modalPostImage: document.getElementById('modalPostImage'),
            modalPreview: document.getElementById('modalPreview'),
            modalPreviewImage: document.getElementById('modalPreviewImage'),
            removeModalPreviewBtn: document.getElementById('removeModalPreviewBtn'),
            cancelModalPost: document.getElementById('cancelModalPost'),
            submitModalPost: document.getElementById('submitModalPost')
        };

        // Club data
        const clubs = {
            logos: { name: 'Logos', icon: 'fa-book-open', color: '#3498db' },
            workfit: { name: 'WorkFit', icon: 'fa-dumbbell', color: '#2ecc71' },
            talantae: { name: 'Talantae', icon: 'fa-star', color: '#9b59b6' },
            stratum: { name: 'Stratum', icon: 'fa-briefcase', color: '#e74c3c' }
        };

        // ====================
        // UTILITY FUNCTIONS
        // ====================
        function showNotification(message, type = 'success', duration = 3000) {
            const toast = elements.notificationToast;
            if (!toast) return;
            
            toast.textContent = message;
            toast.className = `notification-toast show ${type}`;
            setTimeout(() => {
                toast.classList.remove('show');
            }, duration);
        }

        function showSessionStatus(message, type = 'restored') {
            const status = elements.sessionStatus;
            if (!status) return;
            
            status.innerHTML = `<i class="fas fa-${type === 'restored' ? 'check-circle' : 'sync'}"></i><span>${message}</span>`;
            status.className = `session-status visible ${type}`;
            setTimeout(() => status.classList.remove('visible'), 3000);
        }

        function formatTime(timestamp) {
            if (!timestamp) return 'Just now';
            const now = new Date();
            const postTime = new Date(timestamp);
            const diff = Math.floor((now - postTime) / 1000);
            
            if (diff < 60) return 'Just now';
            if (diff < 3600) return `${Math.floor(diff / 60)}m`;
            if (diff < 86400) return `${Math.floor(diff / 3600)}h`;
            if (diff < 604800) return `${Math.floor(diff / 86400)}d`;
            return postTime.toLocaleDateString('en-US', { month: 'short', day: 'numeric' });
        }

        // ====================
        // AUTHENTICATION
        // ====================
        function checkAuthStatus() {
            const storedUser = localStorage.getItem('the_songa_user');
            const storedToken = localStorage.getItem('the_songa_token');
            const sessionTime = localStorage.getItem('the_songa_session_time');
            
            const isValid = storedUser && storedToken && sessionTime && 
                           (Date.now() - parseInt(sessionTime)) < (24 * 60 * 60 * 1000);
            
            if (isValid) {
                try {
                    currentUser = JSON.parse(storedUser);
                    showSessionStatus('Session restored');
                    updateUIForMember();
                    
                    if (elements.signinModal) {
                        elements.signinModal.classList.remove('active');
                    }
                    
                    fetchUserData(currentUser.uid);
                    setupRealtimeListeners();
                    loadPosts();
                    
                    return true;
                } catch (error) {
                    console.error("Error parsing user:", error);
                    clearUserSession();
                    showSigninModal();
                    return false;
                }
            } else {
                clearUserSession();
                showSigninModal();
                loadSamplePosts(); // Show sample posts for demo
                return false;
            }
        }

        function storeUserSession(user, token) {
            localStorage.setItem('the_songa_user', JSON.stringify(user));
            localStorage.setItem('the_songa_token', token);
            localStorage.setItem('the_songa_session_time', Date.now().toString());
            localStorage.setItem('the_songa_selected_clubs', JSON.stringify(selectedClubs));
        }

        function clearUserSession() {
            localStorage.removeItem('the_songa_user');
            localStorage.removeItem('the_songa_token');
            localStorage.removeItem('the_songa_session_time');
            localStorage.removeItem('the_songa_selected_clubs');
            
            currentUser = null;
            currentUserData = null;
            
            // Remove listeners
            realtimeListeners.forEach(listener => {
                if (typeof listener === 'function') listener();
            });
            realtimeListeners = [];
        }

        function updateUIForMember() {
            if (!currentUser) return;
            
            // Update sidebar
            if (elements.sidebarUserAvatar) {
                elements.sidebarUserAvatar.src = currentUser.picture || 'https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp';
            }
            if (elements.sidebarUserName) {
                elements.sidebarUserName.textContent = currentUser.firstName || 'Member';
            }
            if (elements.sidebarUserHandle) {
                elements.sidebarUserHandle.textContent = `@${(currentUser.firstName || 'user').toLowerCase()}`;
            }
            
            // Update compose avatar
            if (elements.composeAvatar) {
                elements.composeAvatar.src = currentUser.picture || 'https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp';
            }
            
            // Enable compose
            if (elements.composeInput) {
                elements.composeInput.disabled = false;
                elements.composeInput.placeholder = "What's happening in the Inner Circle?";
            }
        }

        async function fetchUserData(userId) {
            try {
                const snapshot = await database.ref(`users/${userId}`).once('value');
                if (snapshot.exists()) {
                    currentUserData = snapshot.val();
                    if (currentUserData.selectedClubs) {
                        selectedClubs = currentUserData.selectedClubs;
                    }
                }
            } catch (error) {
                console.error('Error fetching user data:', error);
            }
        }

        function showSigninModal() {
            if (elements.signinModal) {
                elements.signinModal.classList.add('active');
                document.body.classList.add('modal-open');
            }
        }

        // ====================
        // POSTS
        // ====================
        async function loadPosts() {
            if (!elements.postsFeed) return;
            
            try {
                // Show loading
                elements.postsFeed.innerHTML = `
                    <div class="skeleton-post">
                        <div class="skeleton-header">
                            <div class="skeleton-avatar"></div>
                            <div style="flex: 1;">
                                <div class="skeleton-line" style="width: 60%;"></div>
                                <div class="skeleton-line" style="width: 40%;"></div>
                            </div>
                        </div>
                        <div class="skeleton-line" style="width: 100%;"></div>
                        <div class="skeleton-line" style="width: 90%;"></div>
                        <div class="skeleton-line" style="width: 95%;"></div>
                    </div>
                    <div class="skeleton-post">
                        <div class="skeleton-header">
                            <div class="skeleton-avatar"></div>
                            <div style="flex: 1;">
                                <div class="skeleton-line" style="width: 60%;"></div>
                                <div class="skeleton-line" style="width: 40%;"></div>
                            </div>
                        </div>
                        <div class="skeleton-line" style="width: 100%;"></div>
                        <div class="skeleton-line" style="width: 90%;"></div>
                        <div class="skeleton-line" style="width: 95%;"></div>
                    </div>
                `;
                
                const snapshot = await database.ref('communityPosts')
                    .orderByChild('createdAt')
                    .limitToLast(50)
                    .once('value');
                
                if (snapshot.exists()) {
                    const postsData = snapshot.val();
                    posts = Object.keys(postsData)
                        .map(key => ({ id: key, ...postsData[key] }))
                        .filter(post => post.status === 'published' || !post.status)
                        .sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                    
                    renderPosts(posts);
                } else {
                    // No posts, load samples
                    loadSamplePosts();
                }
            } catch (error) {
                console.error('Error loading posts:', error);
                showNotification('Error loading posts', 'error');
                loadSamplePosts(); // Fallback to samples
            }
        }

        function loadSamplePosts() {
            const samplePosts = [
                {
                    id: 'sample1',
                    authorId: 'admin_001',
                    authorName: 'THE SONGA',
                    authorAvatar: 'https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp',
                    title: 'Welcome to the Inner Circle!',
                    content: 'We are thrilled to have you here. This is your space to connect, learn, and grow with like-minded individuals. Share your thoughts, ask questions, and be part of something great.\n\n#Welcome #InnerCircle',
                    category: 'announcement',
                    tags: ['welcome', 'inner-circle'],
                    likes: 42,
                    likedBy: [],
                    comments: 12,
                    shares: 8,
                    bookmarks: 25,
                    views: 324,
                    createdAt: new Date(Date.now() - 2 * 60 * 60 * 1000).toISOString(),
                    isPinned: true,
                    imageUrl: 'https://images.unsplash.com/photo-1522202176988-66273c2fd55f?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'
                },
                {
                    id: 'sample2',
                    authorId: 'user_001',
                    authorName: 'Mugera Moses',
                    authorAvatar: 'https://randomuser.me/api/portraits/men/32.jpg',
                    title: 'Just finished an amazing book!',
                    content: 'Just completed "Atomic Habits" by James Clear. The insights on habit formation are life-changing. Highly recommend to anyone looking to improve themselves.\n\n#Logos #ReadingChallenge #AtomicHabits',
                    category: 'discussion',
                    tags: ['books', 'habits', 'logos'],
                    likes: 18,
                    likedBy: [],
                    comments: 5,
                    shares: 2,
                    bookmarks: 7,
                    views: 89,
                    createdAt: new Date(Date.now() - 1 * 24 * 60 * 60 * 1000).toISOString(),
                    isPinned: false
                },
                {
                    id: 'sample3',
                    authorId: 'user_002',
                    authorName: 'Sarah Johnson',
                    authorAvatar: 'https://randomuser.me/api/portraits/women/44.jpg',
                    title: 'Morning Workout Session',
                    content: 'Great workout with the WorkFit club this morning! Nothing beats starting the day with some exercise and great company. Who\'s joining next week?',
                    category: 'event',
                    tags: ['workfit', 'fitness', 'wellness'],
                    likes: 24,
                    likedBy: [],
                    comments: 8,
                    shares: 3,
                    bookmarks: 5,
                    views: 156,
                    createdAt: new Date(Date.now() - 2 * 24 * 60 * 60 * 1000).toISOString(),
                    isPinned: false,
                    imageUrl: 'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?ixlib=rb-4.0.3&auto=format&fit=crop&w=1200&q=80'
                },
                {
                    id: 'sample4',
                    authorId: 'user_003',
                    authorName: 'David Kimani',
                    authorAvatar: 'https://randomuser.me/api/portraits/men/75.jpg',
                    title: 'Business Strategy Session',
                    content: 'Stratum club members - don\'t forget our strategy session this Thursday at 6 PM. We\'ll be discussing market trends and investment opportunities for Q2.',
                    category: 'resource',
                    tags: ['stratum', 'business', 'strategy'],
                    likes: 15,
                    likedBy: [],
                    comments: 4,
                    shares: 6,
                    bookmarks: 12,
                    views: 78,
                    createdAt: new Date(Date.now() - 3 * 24 * 60 * 60 * 1000).toISOString(),
                    isPinned: false
                }
            ];
            
            posts = samplePosts;
            renderPosts(posts);
        }

        function renderPosts(postsArray) {
            if (!elements.postsFeed) return;
            
            if (!postsArray || postsArray.length === 0) {
                elements.postsFeed.innerHTML = `
                    <div style="text-align: center; padding: 3rem 1rem;">
                        <i class="fas fa-newspaper" style="font-size: 3rem; color: var(--gray-300); margin-bottom: 1rem;"></i>
                        <h3 style="margin-bottom: 0.5rem;">No posts yet</h3>
                        <p style="color: var(--gray-500);">Be the first to share something!</p>
                        ${currentUser ? '<button class="btn-primary" style="margin-top: 1rem;" onclick="document.getElementById(\'composeInput\').focus()">Create Post</button>' : ''}
                    </div>
                `;
                return;
            }
            
            // Sort: pinned first, then by date
            const sorted = [...postsArray].sort((a, b) => {
                if (a.isPinned && !b.isPinned) return -1;
                if (!a.isPinned && b.isPinned) return 1;
                return new Date(b.createdAt || 0) - new Date(a.createdAt || 0);
            });
            
            // Filter by category
            const filtered = currentFilter === 'all' 
                ? sorted 
                : sorted.filter(p => p.category === currentFilter);
            
            elements.postsFeed.innerHTML = filtered.map(post => {
                const isLiked = currentUser && post.likedBy && post.likedBy.includes(currentUser.uid);
                const isSaved = currentUserData && currentUserData.bookmarkedPosts && 
                               currentUserData.bookmarkedPosts.includes(post.id);
                const isOwner = currentUser && post.authorId === currentUser.uid;
                
                const mediaHtml = post.imageUrl ? `
                    <div class="post-media">
                        <img src="${post.imageUrl}" alt="Post image" onclick="viewImage('${post.imageUrl}')">
                    </div>
                ` : '';
                
                const tagsHtml = post.tags && post.tags.length ? `
                    <div class="post-tags">
                        ${post.tags.map(tag => `<span class="post-tag">#${tag}</span>`).join('')}
                    </div>
                ` : '';
                
                const pinnedHtml = post.isPinned ? `
                    <div class="pinned-indicator">
                        <i class="fas fa-thumbtack"></i>
                        <span>Pinned post</span>
                    </div>
                ` : '';
                
                const optionsHtml = isOwner ? `
                    <button class="post-options-btn" onclick="togglePostOptions('${post.id}', event)">
                        <i class="fas fa-ellipsis-h"></i>
                    </button>
                    <div class="post-options-dropdown" id="options-${post.id}">
                        <div class="post-option-item delete" onclick="confirmDeletePost('${post.id}')">
                            <i class="fas fa-trash-alt"></i>
                            <span>Delete</span>
                        </div>
                    </div>
                ` : '';
                
                return `
                    <div class="post-card ${post.isPinned ? 'pinned' : ''}" data-post-id="${post.id}" id="post-${post.id}">
                        ${pinnedHtml}
                        <div class="post-header">
                            <div class="post-avatar">
                                <img src="${post.authorAvatar || 'https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp'}" alt="${post.authorName}">
                            </div>
                            <div class="post-author-info">
                                <div class="post-author-row">
                                    <span class="post-author">${post.authorName}</span>
                                    <span class="post-author-badge">${post.category || 'inner-circle'}</span>
                                    ${optionsHtml}
                                </div>
                                <div class="post-time">
                                    <i class="far fa-clock"></i> ${formatTime(post.createdAt)}
                                    ${post.views ? ` â€¢ <i class="far fa-eye"></i> ${post.views}` : ''}
                                </div>
                            </div>
                        </div>
                        
                        <div class="post-content">
                            ${post.title ? `<h3>${post.title}</h3>` : ''}
                            <p>${post.content || ''}</p>
                            ${mediaHtml}
                            ${tagsHtml}
                        </div>
                        
                        <div class="post-actions">
                            <button class="post-action ${isLiked ? 'liked' : ''}" onclick="handlePostAction('${post.id}', 'like')">
                                <i class="fas fa-heart"></i>
                                <span>${post.likes || 0}</span>
                            </button>
                            <button class="post-action" onclick="handlePostAction('${post.id}', 'comment')">
                                <i class="fas fa-comment"></i>
                                <span>${post.comments || 0}</span>
                            </button>
                            <button class="post-action" onclick="handlePostAction('${post.id}', 'share')">
                                <i class="fas fa-retweet"></i>
                                <span>${post.shares || 0}</span>
                            </button>
                            <button class="post-action ${isSaved ? 'saved' : ''}" onclick="handlePostAction('${post.id}', 'save')">
                                <i class="fas fa-bookmark"></i>
                                <span>${post.bookmarks || 0}</span>
                            </button>
                        </div>
                        
                        <div class="comments-section" id="comments-${post.id}">
                            <!-- Comments will be loaded here -->
                        </div>
                    </div>
                `;
            }).join('');
        }

        // ====================
        // POST ACTIONS
        // ====================
        window.handlePostAction = async function(postId, action) {
            if (!currentUser) {
                showNotification('Please sign in to interact', 'error');
                showSigninModal();
                return;
            }
            
            switch(action) {
                case 'like':
                    await likePost(postId);
                    break;
                case 'comment':
                    toggleComments(postId);
                    break;
                case 'share':
                    await sharePost(postId);
                    break;
                case 'save':
                    await bookmarkPost(postId);
                    break;
            }
        };

        async function likePost(postId) {
            try {
                const postRef = database.ref(`communityPosts/${postId}`);
                const snapshot = await postRef.once('value');
                const post = snapshot.val();
                
                if (!post) return;
                
                let likedBy = post.likedBy || [];
                let likes = post.likes || 0;
                
                if (likedBy.includes(currentUser.uid)) {
                    likedBy = likedBy.filter(id => id !== currentUser.uid);
                    likes--;
                } else {
                    likedBy.push(currentUser.uid);
                    likes++;
                    
                    // Create notification for post owner
                    if (post.authorId !== currentUser.uid) {
                        await createNotification(post.authorId, 'like', {
                            postId,
                            postTitle: post.title,
                            userId: currentUser.uid,
                            userName: currentUser.firstName,
                            userAvatar: currentUser.picture
                        });
                    }
                }
                
                await postRef.update({ likedBy, likes });
                
                // Update UI
                const likeBtn = document.querySelector(`#post-${postId} .post-action:first-child`);
                const likeSpan = likeBtn?.querySelector('span');
                if (likeSpan) likeSpan.textContent = likes;
                
            } catch (error) {
                console.error('Error liking post:', error);
            }
        }

        async function sharePost(postId) {
            try {
                const postRef = database.ref(`communityPosts/${postId}`);
                const snapshot = await postRef.once('value');
                const post = snapshot.val();
                
                if (!post) return;
                
                const shares = (post.shares || 0) + 1;
                await postRef.update({ shares });
                
                // Update UI
                const shareBtn = document.querySelector(`#post-${postId} .post-action:nth-child(3) span`);
                if (shareBtn) shareBtn.textContent = shares;
                
                showNotification('Post shared!', 'success');
                
            } catch (error) {
                console.error('Error sharing post:', error);
            }
        }

        async function bookmarkPost(postId) {
            try {
                const userRef = database.ref(`users/${currentUser.uid}`);
                const snapshot = await userRef.once('value');
                const userData = snapshot.val();
                
                let bookmarks = userData.bookmarkedPosts || [];
                
                if (bookmarks.includes(postId)) {
                    bookmarks = bookmarks.filter(id => id !== postId);
                    showNotification('Removed from bookmarks');
                } else {
                    bookmarks.push(postId);
                    showNotification('Added to bookmarks');
                }
                
                await userRef.update({ bookmarkedPosts: bookmarks });
                
                // Update post bookmark count
                const postRef = database.ref(`communityPosts/${postId}`);
                const postSnapshot = await postRef.once('value');
                const post = postSnapshot.val();
                
                if (post) {
                    let count = post.bookmarks || 0;
                    count = bookmarks.includes(postId) ? count + 1 : Math.max(count - 1, 0);
                    await postRef.update({ bookmarks: count });
                    
                    // Update UI
                    const bookmarkBtn = document.querySelector(`#post-${postId} .post-action:last-child span`);
                    if (bookmarkBtn) bookmarkBtn.textContent = count;
                }
                
            } catch (error) {
                console.error('Error bookmarking:', error);
            }
        }

        function toggleComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (!commentsSection) return;
            
            const isActive = commentsSection.classList.contains('active');
            
            // Close all others
            document.querySelectorAll('.comments-section.active').forEach(s => s.classList.remove('active'));
            
            if (!isActive) {
                commentsSection.classList.add('active');
                loadComments(postId);
            }
        }

        async function loadComments(postId) {
            const commentsSection = document.getElementById(`comments-${postId}`);
            if (!commentsSection) return;
            
            try {
                const snapshot = await database.ref(`comments/${postId}`).once('value');
                
                if (snapshot.exists()) {
                    const comments = Object.values(snapshot.val());
                    
                    commentsSection.innerHTML = `
                        <div class="comments-header">
                            <h4 class="comments-title">Comments</h4>
                            <button class="close-comments" onclick="toggleComments('${postId}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div class="comments-list">
                            ${comments.map(comment => `
                                <div class="comment-item">
                                    <div class="comment-avatar">
                                        <img src="${comment.authorAvatar || 'https://i.postimg.cc/BbdzCkxQ/20260116-0851-Elegant-Lion-Emblem-remix-01kf2npwbtf06ttr4htekjnd47-removebg-preview-2.webp'}" alt="">
                                    </div>
                                    <div class="comment-content">
                                        <div class="comment-header">
                                            <span class="comment-author">${comment.authorName}</span>
                                            <span class="comment-time">${formatTime(comment.createdAt)}</span>
                                        </div>
                                        <div class="comment-text">${comment.text}</div>
                                    </div>
                                </div>
                            `).join('')}
                        </div>
                        ${currentUser ? `
                            <div class="comment-form">
                                <input type="text" class="comment-input" id="comment-input-${postId}" placeholder="Write a comment...">
                                <button class="comment-submit" onclick="submitComment('${postId}')">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        ` : ''}
                    `;
                } else {
                    commentsSection.innerHTML = `
                        <div class="comments-header">
                            <h4 class="comments-title">Comments</h4>
                            <button class="close-comments" onclick="toggleComments('${postId}')">
                                <i class="fas fa-times"></i>
                            </button>
                        </div>
                        <div style="text-align: center; padding: 2rem; color: var(--gray-500);">
                            <i class="far fa-comment-dots" style="font-size: 2rem; margin-bottom: 0.5rem;"></i>
                            <p>No comments yet</p>
                        </div>
                        ${currentUser ? `
                            <div class="comment-form">
                                <input type="text" class="comment-input" id="comment-input-${postId}" placeholder="Write a comment...">
                                <button class="comment-submit" onclick="submitComment('${postId}')">
                                    <i class="fas fa-paper-plane"></i>
                                </button>
                            </div>
                        ` : ''}
                    `;
                }
            } catch (error) {
                console.error('Error loading comments:', error);
            }
        }

        window.submitComment = async function(postId) {
            if (!currentUser) return;
            
            const input = document.getElementById(`comment-input-${postId}`);
            const text = input?.value.trim();
            
            if (!text) return;
            
            try {
                const commentRef = database.ref(`comments/${postId}`).push();
                await commentRef.set({
                    id: commentRef.key,
                    postId,
                    authorId: currentUser.uid,
                    authorName: currentUser.firstName || 'Member',
                    authorAvatar: currentUser.picture,
                    text,
                    createdAt: new Date().toISOString()
                });
                
                // Update post comment count
                const postRef = database.ref(`communityPosts/${postId}`);
                const snapshot = await postRef.once('value');
                const post = snapshot.val();
                
                if (post) {
                    const comments = (post.comments || 0) + 1;
                    await postRef.update({ comments });
                    
                    // Update UI
                    const commentSpan = document.querySelector(`#post-${postId} .post-action:nth-child(2) span`);
                    if (commentSpan) commentSpan.textContent = comments;
                }
                
                input.value = '';
                loadComments(postId);
                
            } catch (error) {
                console.error('Error posting comment:', error);
            }
        };

        // ====================
        // CREATE POST
        // ====================
        function setupCompose() {
            if (!elements.composeInput) return;
            
            // Auto-resize textarea
            elements.composeInput.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
                
                // Enable submit if there's content
                if (elements.composeSubmit) {
                    elements.composeSubmit.disabled = !this.value.trim();
                }
            });
            
            // Image upload
            if (elements.composeImageUpload) {
                elements.composeImageUpload.addEventListener('change', handleImageSelect);
            }
            
            // Remove preview
            if (elements.removePreviewBtn) {
                elements.removePreviewBtn.addEventListener('click', () => {
                    elements.composePreview.style.display = 'none';
                    elements.composeImageUpload.value = '';
                    currentImageFile = null;
                });
            }
            
            // Submit post
            if (elements.composeSubmit) {
                elements.composeSubmit.addEventListener('click', submitComposePost);
            }
            
            // Mobile create post
            if (elements.mobileCreatePost) {
                elements.mobileCreatePost.addEventListener('click', () => {
                    if (!currentUser) {
                        showSigninModal();
                    } else {
                        openCreatePostModal();
                    }
                });
            }
            
            if (elements.sidebarCreatePost) {
                elements.sidebarCreatePost.addEventListener('click', () => {
                    if (!currentUser) {
                        showSigninModal();
                    } else {
                        elements.composeInput?.focus();
                    }
                });
            }
        }

        function handleImageSelect(event) {
            const file = event.target.files[0];
            if (!file) return;
            
            // Check size (10MB)
            if (file.size > 10 * 1024 * 1024) {
                showNotification('Image too large (max 10MB)', 'error');
                return;
            }
            
            currentImageFile = file;
            
            const reader = new FileReader();
            reader.onload = (e) => {
                if (elements.previewImage) {
                    elements.previewImage.src = e.target.result;
                }
                if (elements.composePreview) {
                    elements.composePreview.style.display = 'block';
                }
            };
            reader.readAsDataURL(file);
        }

        async function submitComposePost() {
            if (!currentUser || !elements.composeInput) return;
            
            const content = elements.composeInput.value.trim();
            if (!content) return;
            
            try {
                elements.composeSubmit.disabled = true;
                elements.composeSubmit.textContent = 'Posting...';
                
                // Upload image if any
                let imageUrl = null;
                if (currentImageFile && storage) {
                    const storageRef = storage.ref();
                    const imageRef = storageRef.child(`post_images/${Date.now()}_${currentImageFile.name}`);
                    await imageRef.put(currentImageFile);
                    imageUrl = await imageRef.getDownloadURL();
                }
                
                const postRef = database.ref('communityPosts').push();
                const newPost = {
                    id: postRef.key,
                    authorId: currentUser.uid,
                    authorName: currentUser.firstName || 'Member',
                    authorAvatar: currentUser.picture,
                    content,
                    imageUrl,
                    category: 'discussion',
                    likes: 0,
                    likedBy: [],
                    comments: 0,
                    shares: 0,
                    bookmarks: 0,
                    views: 0,
                    createdAt: new Date().toISOString(),
                    status: 'published'
                };
                
                await postRef.set(newPost);
                
                // Reset compose
                elements.composeInput.value = '';
                elements.composeInput.style.height = 'auto';
                elements.composePreview.style.display = 'none';
                elements.composeImageUpload.value = '';
                currentImageFile = null;
                
                showNotification('Post published!', 'success');
                
            } catch (error) {
                console.error('Error posting:', error);
                showNotification('Error publishing post', 'error');
            } finally {
                elements.composeSubmit.disabled = false;
                elements.composeSubmit.textContent = 'Post';
            }
        }

        // ====================
        // NOTIFICATIONS
        // ====================
        async function createNotification(userId, type, data) {
            try {
                const notifRef = database.ref(`notifications/${userId}`).push();
                await notifRef.set({
                    id: notifRef.key,
                    type,
                    data,
                    read: false,
                    timestamp: new Date().toISOString()
                });
            } catch (error) {
                console.error('Error creating notification:', error);
            }
        }

        // ====================
        // ONBOARDING
        // ====================
        function setupOnboarding() {
            // Step navigation
            if (elements.startOnboardingBtn) {
                elements.startOnboardingBtn.addEventListener('click', () => goToStep(2));
            }
            
            if (elements.backToStep1Btn) {
                elements.backToStep1Btn.addEventListener('click', () => goToStep(1));
            }
            
            if (elements.continueToStep3Btn) {
                elements.continueToStep3Btn.addEventListener('click', () => goToStep(3));
            }
            
            if (elements.backToStep2Btn) {
                elements.backToStep2Btn.addEventListener('click', () => goToStep(2));
            }
            
            // Club selection
            document.querySelectorAll('.club-card').forEach(card => {
                card.addEventListener('click', () => {
                    const club = card.dataset.club;
                    toggleClub(club, card);
                });
            });
        }

        function goToStep(step) {
            currentStep = step;
            
            // Update indicators
            document.querySelectorAll('.step-indicator').forEach((ind, i) => {
                ind.classList.toggle('active', i + 1 === step);
            });
            
            // Update slides
            document.querySelectorAll('.onboarding-slide').forEach((slide, i) => {
                slide.classList.toggle('active', i + 1 === step);
            });
            
            if (step === 3) {
                updateSelectedClubsDisplay();
            }
        }

        function toggleClub(clubId, card) {
            const index = selectedClubs.indexOf(clubId);
            
            if (index === -1) {
                selectedClubs.push(clubId);
                card.classList.add('selected');
            } else {
                selectedClubs.splice(index, 1);
                card.classList.remove('selected');
            }
            
            if (elements.continueToStep3Btn) {
                elements.continueToStep3Btn.disabled = selectedClubs.length === 0;
            }
        }

        function updateSelectedClubsDisplay() {
            if (!elements.selectedClubsList) return;
            
            elements.selectedClubsList.innerHTML = selectedClubs.map(club => {
                const c = clubs[club];
                return `<span style="background: var(--gold-light); padding: 0.5rem 1rem; border-radius: 30px; font-size: 0.9rem;">
                    <i class="fas ${c.icon}" style="color: ${c.color};"></i> ${c.name}
                </span>`;
            }).join('');
        }

        // ====================
        // GOOGLE SIGN IN
        // ====================
        window.handleGoogleSignIn = async function(response) {
            try {
                const credential = response.credential;
                const userData = parseJwt(credential);
                
                currentUser = {
                    uid: userData.sub,
                    email: userData.email,
                    firstName: userData.given_name,
                    lastName: userData.family_name,
                    fullName: userData.name,
                    picture: userData.picture
                };
                
                // Store session
                storeUserSession(currentUser, credential);
                
                // Save to database
                const userRef = database.ref(`users/${currentUser.uid}`);
                const snapshot = await userRef.once('value');
                
                if (!snapshot.exists()) {
                    const newUser = {
                        uid: currentUser.uid,
                        email: currentUser.email,
                        firstName: currentUser.firstName,
                        lastName: currentUser.lastName,
                        profilePicture: currentUser.picture,
                        selectedClubs,
                        joinedDate: new Date().toISOString(),
                        lastLogin: new Date().toISOString(),
                        membershipStatus: 'active',
                        membershipTier: 'inner-circle'
                    };
                    await userRef.set(newUser);
                } else {
                    await userRef.update({ 
                        lastLogin: new Date().toISOString(),
                        selectedClubs 
                    });
                }
                
                // Update UI
                updateUIForMember();
                
                // Close modal
                if (elements.signinModal) {
                    elements.signinModal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                }
                
                showNotification(`Welcome, ${currentUser.firstName}!`, 'success');
                
                // Load real posts
                loadPosts();
                
            } catch (error) {
                console.error('Sign in error:', error);
                showNotification('Sign in failed', 'error');
            }
        };

        function parseJwt(token) {
            try {
                const base64Url = token.split('.')[1];
                const base64 = base64Url.replace(/-/g, '+').replace(/_/g, '/');
                return JSON.parse(atob(base64));
            } catch (error) {
                console.error('Error parsing JWT:', error);
                return {};
            }
        }

        // ====================
        // REALTIME LISTENERS
        // ====================
        function setupRealtimeListeners() {
            if (!currentUser || !database) return;
            
            // Listen for notifications
            const notifListener = database.ref(`notifications/${currentUser.uid}`)
                .limitToLast(20)
                .on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const unread = Object.values(snapshot.val()).filter(n => !n.read).length;
                        const badge = document.getElementById('sidebarNotificationBadge');
                        if (badge) {
                            badge.textContent = unread > 99 ? '99+' : unread;
                            badge.classList.toggle('hidden', unread === 0);
                        }
                    }
                });
            
            realtimeListeners.push(() => database.ref(`notifications/${currentUser.uid}`).off('value', notifListener));
            
            // Listen for posts
            const postsListener = database.ref('communityPosts')
                .orderByChild('createdAt')
                .limitToLast(50)
                .on('value', (snapshot) => {
                    if (snapshot.exists()) {
                        const postsData = snapshot.val();
                        posts = Object.keys(postsData)
                            .map(key => ({ id: key, ...postsData[key] }))
                            .filter(p => p.status === 'published' || !p.status)
                            .sort((a, b) => new Date(b.createdAt || 0) - new Date(a.createdAt || 0));
                        
                        renderPosts(posts);
                        
                        // Show new posts indicator if there are newer posts
                        const lastViewed = localStorage.getItem('the_songa_last_viewed');
                        if (lastViewed) {
                            const newPosts = posts.filter(p => new Date(p.createdAt) > new Date(parseInt(lastViewed)));
                            if (newPosts.length > 0 && elements.newPostsIndicator) {
                                elements.newPostsIndicator.style.display = 'flex';
                            }
                        }
                    }
                });
            
            realtimeListeners.push(() => database.ref('communityPosts').off('value', postsListener));
        }

        // ====================
        // VIEW IMAGE
        // ====================
        window.viewImage = function(imageUrl) {
            const modal = document.createElement('div');
            modal.className = 'modal active';
            modal.innerHTML = `
                <div class="modal-content" style="max-width: 90vw; background: transparent; box-shadow: none;">
                    <button class="close-modal" style="background: rgba(0,0,0,0.5); color: white;">&times;</button>
                    <img src="${imageUrl}" style="width: 100%; border-radius: 12px;">
                </div>
            `;
            
            document.body.appendChild(modal);
            document.body.classList.add('modal-open');
            
            modal.addEventListener('click', (e) => {
                if (e.target === modal || e.target.classList.contains('close-modal')) {
                    document.body.removeChild(modal);
                    document.body.classList.remove('modal-open');
                }
            });
        };

        // ====================
        // POST OPTIONS
        // ====================
        window.togglePostOptions = function(postId, event) {
            event.stopPropagation();
            
            document.querySelectorAll('.post-options-dropdown.active').forEach(d => d.classList.remove('active'));
            
            const dropdown = document.getElementById(`options-${postId}`);
            if (dropdown) {
                dropdown.classList.toggle('active');
            }
        };

        window.confirmDeletePost = function(postId) {
            postToDelete = postId;
            
            if (confirm('Delete this post? This cannot be undone.')) {
                deletePost();
            }
            
            closePostOptions();
        };

        async function deletePost() {
            if (!postToDelete || !currentUser) return;
            
            try {
                await database.ref(`communityPosts/${postToDelete}`).remove();
                await database.ref(`comments/${postToDelete}`).remove();
                showNotification('Post deleted', 'success');
                postToDelete = null;
            } catch (error) {
                console.error('Error deleting:', error);
                showNotification('Error deleting post', 'error');
            }
        }

        function closePostOptions() {
            document.querySelectorAll('.post-options-dropdown.active').forEach(d => d.classList.remove('active'));
        }

        // ====================
        // MODAL FUNCTIONS
        // ====================
        function openCreatePostModal() {
            if (!currentUser) {
                showSigninModal();
                return;
            }
            
            if (elements.createPostModal) {
                elements.createPostModal.classList.add('active');
                document.body.classList.add('modal-open');
            }
        }

        function closeCreatePostModal() {
            if (elements.createPostModal) {
                elements.createPostModal.classList.remove('active');
                document.body.classList.remove('modal-open');
            }
            if (elements.modalPostContent) {
                elements.modalPostContent.value = '';
            }
            if (elements.modalPreview) {
                elements.modalPreview.style.display = 'none';
            }
        }

        // ====================
        // EVENT LISTENERS
        // ====================
        function initEventListeners() {
            // Back to top
            window.addEventListener('scroll', () => {
                if (window.scrollY > 300) {
                    elements.backToTop?.classList.add('visible');
                } else {
                    elements.backToTop?.classList.remove('visible');
                }
            });
            
            if (elements.backToTop) {
                elements.backToTop.addEventListener('click', () => {
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            
            // Sidebar user dropdown
            if (elements.sidebarUser) {
                elements.sidebarUser.addEventListener('click', (e) => {
                    e.stopPropagation();
                    elements.userDropdown?.classList.toggle('active');
                });
            }
            
            // Close dropdowns on outside click
            document.addEventListener('click', () => {
                elements.userDropdown?.classList.remove('active');
                closePostOptions();
            });
            
            // Sign out
            if (elements.signOutOption) {
                elements.signOutOption.addEventListener('click', () => {
                    clearUserSession();
                    updateUIForMember();
                    showNotification('Signed out', 'success');
                    showSigninModal();
                    loadSamplePosts(); // Show samples when signed out
                });
            }
            
            // Close modals
            if (elements.closeSigninModal) {
                elements.closeSigninModal.addEventListener('click', () => {
                    elements.signinModal.classList.remove('active');
                    document.body.classList.remove('modal-open');
                });
            }
            
            if (elements.closeCreatePostModal) {
                elements.closeCreatePostModal.addEventListener('click', closeCreatePostModal);
            }
            
            if (elements.cancelModalPost) {
                elements.cancelModalPost.addEventListener('click', closeCreatePostModal);
            }
            
            // Category filters
            elements.categoryFilters.forEach(btn => {
                btn.addEventListener('click', () => {
                    elements.categoryFilters.forEach(b => b.classList.remove('active'));
                    btn.classList.add('active');
                    currentFilter = btn.dataset.category;
                    renderPosts(posts);
                });
            });
            
            // New posts indicator
            if (elements.newPostsIndicator) {
                elements.newPostsIndicator.addEventListener('click', () => {
                    localStorage.setItem('the_songa_last_viewed', Date.now().toString());
                    elements.newPostsIndicator.style.display = 'none';
                    window.scrollTo({ top: 0, behavior: 'smooth' });
                });
            }
            
            // Modal image upload
            if (elements.modalPostImage) {
                elements.modalPostImage.addEventListener('change', (e) => {
                    const file = e.target.files[0];
                    if (file) {
                        const reader = new FileReader();
                        reader.onload = (e) => {
                            if (elements.modalPreviewImage) {
                                elements.modalPreviewImage.src = e.target.result;
                            }
                            if (elements.modalPreview) {
                                elements.modalPreview.style.display = 'block';
                            }
                        };
                        reader.readAsDataURL(file);
                    }
                });
            }
            
            if (elements.removeModalPreviewBtn) {
                elements.removeModalPreviewBtn.addEventListener('click', () => {
                    elements.modalPreview.style.display = 'none';
                    elements.modalPostImage.value = '';
                });
            }
            
            // Modal form submit
            if (elements.createPostForm) {
                elements.createPostForm.addEventListener('submit', async (e) => {
                    e.preventDefault();
                    
                    const content = elements.modalPostContent?.value.trim();
                    if (!content) return;
                    
                    try {
                        elements.submitModalPost.disabled = true;
                        elements.submitModalPost.textContent = 'Posting...';
                        
                        // Upload image if any
                        let imageUrl = null;
                        const file = elements.modalPostImage?.files[0];
                        if (file && storage) {
                            const storageRef = storage.ref();
                            const imageRef = storageRef.child(`post_images/${Date.now()}_${file.name}`);
                            await imageRef.put(file);
                            imageUrl = await imageRef.getDownloadURL();
                        }
                        
                        const postRef = database.ref('communityPosts').push();
                        await postRef.set({
                            id: postRef.key,
                            authorId: currentUser.uid,
                            authorName: currentUser.firstName || 'Member',
                            authorAvatar: currentUser.picture,
                            content,
                            imageUrl,
                            category: 'discussion',
                            likes: 0,
                            likedBy: [],
                            comments: 0,
                            shares: 0,
                            bookmarks: 0,
                            views: 0,
                            createdAt: new Date().toISOString(),
                            status: 'published'
                        });
                        
                        closeCreatePostModal();
                        showNotification('Post published!', 'success');
                        
                    } catch (error) {
                        console.error('Error:', error);
                        showNotification('Error publishing post', 'error');
                    } finally {
                        elements.submitModalPost.disabled = false;
                        elements.submitModalPost.textContent = 'Post';
                    }
                });
            }
        }

        // ====================
        // INITIALIZATION
        // ====================
        function init() {
            // Check auth
            checkAuthStatus();
            
            // Setup compose
            setupCompose();
            
            // Setup onboarding
            setupOnboarding();
            
            // Setup event listeners
            initEventListeners();
            
            // Load posts (or samples)
            if (!currentUser) {
                loadSamplePosts();
            } else {
                loadPosts();
            }
        }

        // Start when DOM ready
        document.addEventListener('DOMContentLoaded', init);
    </script>
</body>
</html>
